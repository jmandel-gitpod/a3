(this["webpackJsonpa3-ui"]=this["webpackJsonpa3-ui"]||[]).push([[0],{58:function(e,t,a){e.exports=a(73)},63:function(e,t,a){},64:function(e,t,a){},73:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(17),l=a.n(r),o=(a(63),a(64),a(3)),c=a(11),d=a(21),u=a.n(d),m=a(78),s=a(54),f=a(49),p=a(33),v=a(12),E=a(48),y=a(8),b=a(9);var g=function(e){var t={comparator:[{value:"populated",display:"Populated"},{value:"not_populated",display:"Not Populated"},{value:"eq",display:"Equal To"},{value:"lt",display:"Before"},{value:"lte",display:"Before (Inclusive)"},{value:"gt",display:"After"},{value:"gte",display:"After (Inclusive)"}],compareTarget:[{value:"run",display:"Query Run Date"},{value:"fixed",display:"Fixed Date"}],offsetDir:[{value:"plus",display:"+"},{value:"minus",display:"-"}],offsetUnit:[{value:"minutes",display:"Minutes"},{value:"hours",display:"Hours"},{value:"days",display:"Days"},{value:"months",display:"Months"},{value:"years",display:"Years"}]},a=function(t,a){var n=Object(o.a)(Object(o.a)({},e.data),{},Object(v.a)({},t,a)),i=function(e){var t=-1===e.comparator.indexOf("populated")&&"fixed"===e.compareTo&&!/^\d{4}-\d{2}-\d{2}$/.test(e.fixedValue);return t&&{fixedValue:t}}(n);e.onUpdate(Object(o.a)(Object(o.a)({},n),{},{invalid:i}))},n=function(e){return t[e].map((function(e){return i.a.createElement("option",{value:e.value,key:e.value},e.display)}))},r=e.data.comparator&&-1!==e.data.comparator.indexOf("populated");return e.edit?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"my-2"},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",null,"is"),!e.hideControls&&i.a.createElement(y.a,{icon:b.b,opacity:"0.5",onClick:function(t){return e.onDelete(e.id)},style:{cursor:"pointer"},pull:"right"})),i.a.createElement("div",{className:"my-2"},i.a.createElement("select",{className:"form-control",value:e.data.comparator||"gt",onChange:function(e){return a("comparator",e.target.value)}},n("comparator"))),!r&&function(){var t=e.data.validate&&e.data.invalid;return i.a.createElement("div",{className:"my-2 form-row"},i.a.createElement(E.a,null,i.a.createElement("select",{className:"form-control",value:e.data.compareTo||"fixed",onChange:function(e){return a("compareTo",e.target.value)}},n("compareTarget"),(e.relativeOptions||[]).sort().map((function(e){return i.a.createElement("option",{key:e.value,value:e.value},e.label)})))),(!e.data.compareTo||"fixed"===e.data.compareTo)&&i.a.createElement(E.a,null,i.a.createElement("input",Object(v.a)({type:"date",className:"form-control",required:!0,value:e.data.fixedValue||"",onChange:function(e){return a("fixedValue",e.target.value)}},"className",t?"is-invalid form-control":"form-control"))))}(),!r&&"fixed"!==e.data.compareTo&&i.a.createElement("div",{className:"my-2 form-row"},i.a.createElement(E.a,null,i.a.createElement("select",{className:"form-control",value:e.data.offsetDir||"plus",onChange:function(e){return a("offsetDir",e.target.value)}},n("offsetDir"))),i.a.createElement(E.a,null,i.a.createElement("input",{type:"number",className:"form-control",value:e.data.offsetValue||"",required:!0,onChange:function(e){return a("offsetValue",e.target.value)}})),i.a.createElement(E.a,null,i.a.createElement("select",{className:"form-control",value:e.data.offsetUnit||"years",onChange:function(e){return a("offsetUnit",e.target.value)}},n("offsetUnit"))))):function(){var a=function(){if(e.data.offsetValue)return i.a.createElement("span",{className:"mr-1 mt-1 mark"},n("offsetDir",e.data.offsetDir)," ",e.data.offsetValue," ",n("offsetUnit",e.data.offsetUnit))},n=function(e,a){return t[e].find((function(e){return e.value===a})).display},l=!r&&e.data.compareTo.indexOf(".")>-1&&e.relativeOptions.find((function(t){return t.value===e.data.compareTo})).label;return i.a.createElement("div",null,!e.hideControls&&i.a.createElement(y.a,{icon:b.a,opacity:"0.5",style:{cursor:"pointer"},pull:"right",className:"m-1"}),i.a.createElement("div",{style:{lineHeight:2}},i.a.createElement("span",{className:"mt-1 mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",{className:"mt-1 mr-1"},"is"),i.a.createElement("span",{className:"mt-1 mr-1 mark"},n("comparator",e.data.comparator).toLowerCase()),!r&&"fixed"===e.data.compareTo&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mt-1 mr-1 mark"},"fixed value"),i.a.createElement("span",{className:"mt-1 mr-1"},"of"),i.a.createElement("span",{className:"mt-1 mr-1 mark"},e.data.fixedValue)),!r&&"run"===e.data.compareTo&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mt-1 mr-1 mark"},"Query Run Date"),a()),!r&&e.data.compareTo.indexOf(".")>-1&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"d-inline-block"},i.a.createElement("span",{className:"mt-1 mr-1 mark"},l)),a())))}()};var h=function(e){var t=function(t,a){var n=Object(o.a)(Object(o.a)({},e.data),{},Object(v.a)({},t,a)),i=function(t){var a=(!e.fieldDefinition.options||"__custom"===t.option)&&0===(t.code||"").replace(/[\s,]/g).length;return a&&{code:a}}(n);e.onUpdate(Object(o.a)(Object(o.a)({},n),{},{invalid:i}))},a=function(){return i.a.createElement("div",{className:"my-2"},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",null,"matches at least one code in"),!e.hideControls&&i.a.createElement(y.a,{icon:b.b,opacity:"0.5",onClick:function(t){return e.onDelete(e.id)},style:{cursor:"pointer"},pull:"right"}))};return e.edit?"__custom"!==e.data.option&&e.fieldDefinition.options?function(){var a=(e.fieldDefinition.options.find((function(t){return t.name===e.data.name&&t.system===e.data.system&&t.code===e.data.code}))||{}).name;return i.a.createElement("div",null,i.a.createElement("div",{className:"my-2"},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",null,"is"),!e.hideControls&&i.a.createElement(y.a,{icon:b.b,opacity:"0.5",onClick:function(t){return e.onDelete(e.id)},style:{cursor:"pointer"},pull:"right"})),i.a.createElement("select",{value:e.data.option||"",onChange:function(e){return t("option",e.target.value)},className:e.data.invalid&&e.data.validate?"is-invalid form-control":"form-control"},!a&&i.a.createElement("option",{value:""}),e.fieldDefinition.options.map((function(e){return i.a.createElement("option",{value:e.name,key:e.name},function(e){var t=(e.code||"").split(",").length,a=t>1?" (".concat(t," codes)"):"";return e.name+a}(e))})),e.fieldDefinition.editable&&i.a.createElement("option",{value:"__custom",key:"__custom"},"Custom")))}():i.a.createElement("div",null,a(),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",null,"Name (optional)"),i.a.createElement("input",{className:"form-control",value:e.data.name||"",onChange:function(e){return t("name",e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",null,"System (optional)"),i.a.createElement("input",{className:"form-control",value:e.data.system||"",placeholder:"http://loinc.org",onChange:function(e){return t("system",e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",null,"Codes (comma separated)"),i.a.createElement("textarea",{value:e.data.code||"",onChange:function(e){return t("code",e.target.value)},className:e.data.invalid&&e.data.validate?"is-invalid form-control":"form-control"}))):function(){var t=e.data.code?e.data.code.split(",").length:0,a=e.data.option&&"__custom"!==e.data.option&&e.data.option.replace(/^[ -]*/,"")||e.data.name||1===t&&e.data.code||"Unnamed";return i.a.createElement("div",null,!e.hideControls&&i.a.createElement(y.a,{icon:b.a,opacity:"0.5",style:{cursor:"pointer"},pull:"right",className:"m-1"}),i.a.createElement("div",{style:{lineHeight:2}},i.a.createElement("span",{className:"mt-1 mr-1 font-weight-bold"},e.fieldDefinition.name),t>1?" matches at least one code in valueset ":" matches code ",i.a.createElement("span",{className:"mark mt-1"},a),t>1&&i.a.createElement("span",{className:"mt-1"},"(",t," codes)")))}()};var N=function(e){return e.edit?i.a.createElement("div",null,i.a.createElement("div",{className:"my-2"},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",null,"is equal to"),!e.hideControls&&i.a.createElement(y.a,{icon:b.b,opacity:"0.5",onClick:function(t){return e.onDelete(e.id)},style:{cursor:"pointer"},pull:"right"})),i.a.createElement("select",{value:e.data.target,className:e.data.validate&&!e.data.target?"is-invalid form-control":"form-control",onChange:function(t){return function(t,a){var n=Object(o.a)(Object(o.a)({},e.data),{},Object(v.a)({},t,a));e.onUpdate(Object(o.a)(Object(o.a)({},n),{},{invalid:!1}))}("target",t.target.value)}},!e.data.target&&i.a.createElement("option",{key:"",value:""}),(e.relativeOptions||[]).sort().map((function(e){return i.a.createElement("option",{key:e.value,value:e.value},e.label)})))):function(){var t=e.data.target?e.relativeOptions.find((function(t){return t.value===e.data.target})).label:"";return i.a.createElement("div",null,!e.hideControls&&i.a.createElement(y.a,{icon:b.a,opacity:"0.5",style:{cursor:"pointer"},pull:"right",className:"m-1"}),i.a.createElement("div",{style:{lineHeight:2,paddingLeft:"24px",textIndent:"-24px"}},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",{className:"mr-1"},"is equal to"),i.a.createElement("span",{className:"mr-1 mark"},t)))}()};var O=function(e){var t=function(t,a){var n=e.data.children.map((function(e,n){return n===t?a:e}));t>n.length-1&&(n[t]=a);var i=n.filter((function(e){return!!e.invalid})).length>0;e.onUpdate(Object(o.a)(Object(o.a)({},e.data),{},{children:n,invalid:i}))},a=function(t){/^[a-zA-Z_]?[a-zA-Z0-9_]*$/.test(t.target.value)&&e.onUpdate(Object(o.a)(Object(o.a)({},e.data),{},{name:t.target.value}))};return i.a.createElement(i.a.Fragment,null,e.edit?i.a.createElement("div",null,i.a.createElement("span",{className:"font-weight-bold"},e.fieldDefinition.name),i.a.createElement(y.a,{icon:b.b,opacity:"0.5",style:{cursor:"pointer"},pull:"right",onClick:function(t){return e.onDelete(e.id)}}),i.a.createElement("div",{className:"my-2"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Rule Name (letters, numbers or underscore)",value:e.data.name||"",onChange:a}))):i.a.createElement("div",{className:"d-flex justify-content-between align-items-top"},i.a.createElement("span",{className:"font-weight-bold"},e.fieldDefinition.name," ","(",i.a.createElement("span",{className:"mark"},e.data.name||"Unnamed"),")"),!e.hideControls&&i.a.createElement(y.a,{icon:b.a,opacity:"0.5",style:{cursor:"pointer"},className:"m-1"})),e.fieldDefinition.fields.map((function(a,n){return i.a.createElement("div",{key:n,className:"ml-4 my-3"},function(a,n,r){if("instant"===n.type){var l=(e.relativeOptions||[]).filter((function(e){return"instant"===e.type}));return i.a.createElement(g,{data:Object(o.a)(Object(o.a)({},a),{},{validate:e.data.validate}),fieldDefinition:n,relativeOptions:l,edit:e.edit,onUpdate:function(e){return t(r,e)},hideControls:!0})}if("coding"===n.type)return i.a.createElement(h,{data:Object(o.a)(Object(o.a)({},a),{},{validate:e.data.validate}),fieldDefinition:n,edit:e.edit,onUpdate:function(e){return t(r,e)},hideControls:!0});if("fhirId"===e.fieldDefinition.type){var c=(e.relativeOptions||[]).filter((function(e){return"fhirId"===e.fieldType}));return i.a.createElement(N,{relativeOptions:c,data:Object(o.a)(Object(o.a)({},a),{},{validate:e.data.validate}),fieldDefinition:n,edit:e.edit,onUpdate:function(e){return t(r,e)},hideControls:!0})}}(e.data.children[n],a,n))})))},D=a(81),j=a(56);var x=function(e){var t={comparator:[{value:"populated",display:"Populated"},{value:"not_populated",display:"Not Populated"},{value:"eq",display:"Equal To"},{value:"lt",display:"Less then"},{value:"lte",display:"Less than or equal to"},{value:"gt",display:"Greater than"},{value:"gte",display:"Greater than or equal to"}],compareTarget:[{value:"fixed",display:"Fixed Value of"}],offsetDir:[{value:"plus",display:"+"},{value:"minus",display:"-"}]},a=function(t,a){var n=Object(o.a)(Object(o.a)({},e.data),{},Object(v.a)({},t,a)),i=function(e){var t=-1===e.comparator.indexOf("populated")&&"fixed"===e.compareTo&&!/^\d+\.?\d+$/.test(e.fixedValue),a=e.unitCode&&e.unitCode.trim().indexOf(" ")>-1,n=e.unitSystem&&e.unitSystem.trim().indexOf(" ")>-1;return(t||a||n)&&{fixedValue:t,unitCode:a,unitSystem:n}}(n);e.onUpdate(Object(o.a)(Object(o.a)({},n),{},{invalid:i}))},n=function(e){return t[e].map((function(e){return i.a.createElement("option",{value:e.value,key:e.value},e.display)}))},r=e.data.comparator&&-1!==e.data.comparator.indexOf("populated");return e.edit?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"my-2"},i.a.createElement("span",{className:"mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",null,"is"),!e.hideControls&&i.a.createElement(y.a,{icon:b.b,opacity:"0.5",onClick:function(t){return e.onDelete(e.id)},style:{cursor:"pointer"},pull:"right"})),i.a.createElement("div",{className:"my-2"},i.a.createElement("select",{className:"form-control",value:e.data.comparator||"gt",onChange:function(e){return a("comparator",e.target.value)}},n("comparator"))),!r&&function(){var t=e.data.validate&&e.data.invalid&&e.data.invalid.fixedValue,r=e.data.validate&&e.data.invalid&&e.data.invalid.unitSystem,l=e.data.validate&&e.data.invalid&&e.data.invalid.unitCode;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"my-2 form-row"},i.a.createElement(E.a,null,i.a.createElement("select",{className:"form-control",value:e.data.compareTo||"fixed",onChange:function(e){return a("compareTo",e.target.value)}},n("compareTarget"),(e.relativeOptions||[]).sort().map((function(e){return i.a.createElement("option",{key:e.value,value:e.value},e.label)})))),(!e.data.compareTo||"fixed"===e.data.compareTo)&&i.a.createElement(E.a,null,i.a.createElement("input",Object(v.a)({type:"number",className:"form-control",required:!0,value:e.data.fixedValue||"",onChange:function(e){return a("fixedValue",e.target.value)}},"className",t?"is-invalid form-control":"form-control")))),"fixed"===e.data.compareTo&&i.a.createElement("div",{className:"form-row my-2"},i.a.createElement(E.a,{xs:"4"},i.a.createElement("input",Object(v.a)({className:"form-control",required:!1,value:e.data.unitCode||"",placeholder:"Unit Code",onChange:function(e){return a("unitCode",e.target.value)}},"className",l?"is-invalid form-control":"form-control"))),i.a.createElement(E.a,null,i.a.createElement("input",Object(v.a)({className:"form-control",required:!1,value:e.data.unitSystem||"",placeholder:"Unit System",onChange:function(e){return a("unitSystem",e.target.value)}},"className",r?"is-invalid form-control":"form-control")))))}(),!r&&"fixed"!==e.data.compareTo&&i.a.createElement("div",{className:"my-2 form-row"},i.a.createElement(E.a,null,i.a.createElement("select",{className:"form-control",value:e.data.offsetDir||"plus",onChange:function(e){return a("offsetDir",e.target.value)}},n("offsetDir"))),i.a.createElement(E.a,null,i.a.createElement("input",{type:"number",className:"form-control",value:e.data.offsetValue||"",required:!0,onChange:function(e){return a("offsetValue",e.target.value)}})))):function(){var a=function(e,a){return t[e].find((function(e){return e.value===a})).display},n=!r&&e.data.compareTo.indexOf(".")>-1&&e.relativeOptions.find((function(t){return t.value===e.data.compareTo})).label;return i.a.createElement("div",null,!e.hideControls&&i.a.createElement(y.a,{icon:b.a,opacity:"0.5",style:{cursor:"pointer"},pull:"right",className:"m-1"}),i.a.createElement("div",{style:{lineHeight:2}},i.a.createElement("span",{className:"mt-1 mr-1 font-weight-bold"},e.fieldDefinition.name),i.a.createElement("span",{className:"mt-1 mr-1"},"is"),i.a.createElement("span",{className:"mt-1 mr-1 mark"},a("comparator",e.data.comparator).toLowerCase()),!r&&"fixed"===e.data.compareTo&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mt-1 mr-1 mark"},e.data.fixedValue),e.data.unitCode&&i.a.createElement("span",{className:"mt-1 mr-1 mark"},e.data.unitCode)),!r&&e.data.compareTo.indexOf(".")>-1&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"d-inline-block"},i.a.createElement("span",{className:"mt-1 mr-1 mark"},n)),function(){if(e.data.offsetValue)return i.a.createElement("span",{className:"mr-1 mt-1 mark"},a("offsetDir",e.data.offsetDir)," ",e.data.offsetValue)}())))}()};function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("composite"===e.type){var a=e.fields.map((function(e,a){return k(e,t&&t[a]||{})}));return{children:a}}return"instant"===e.type?Object(o.a)(Object(o.a)(Object(o.a)({invalid:!1},{comparator:"gte",compareTo:"fixed",fixedValue:"2020-01-01",offsetUnit:"years",offsetDir:"plus",offsetValue:0,invalid:!1}),e.defaults||{}),t):"quantity"===e.type?Object(o.a)(Object(o.a)(Object(o.a)({invalid:!1},{comparator:"gte",compareTo:"fixed",fixedValue:"",offsetDir:"plus",offsetValue:0,invalid:!1}),e.defaults||{}),t):"coding"===e.type?Object(o.a)(Object(o.a)(Object(o.a)({invalid:!0},{invalid:{code:!0}}),e.defaults||{}),t):Object(o.a)(Object(o.a)({invalid:!0},e.defaults||{}),t)}var C=function(e){var t=Object(n.useState)(e.edit),a=Object(c.a)(t,2),r=a[0],l=a[1],d=function(t,a){e.onUpdate(e.data.map((function(e,n){return t===n?a:e})))},u=function(t){if(1===e.data.length)return e.onDelete(e.id);e.onUpdate(e.data.filter((function(e,a){return t!==a})))};return i.a.createElement(D.a,{className:"shadow my-4"},r&&i.a.createElement(j.a,{className:"text-right"},i.a.createElement(f.a,{variant:"outline-primary",size:"sm",onClick:function(){if(e.data.filter((function(e){return!!e.invalid})).length)return e.onUpdate(e.data.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{validate:!0})})));l(!1)}},"Done")),e.data.map((function(t,a){return i.a.createElement(j.a,{key:a,onClick:function(e){return!r&&l(!0)}},a>0&&i.a.createElement("div",{className:"text-center p-1 mb-1"},i.a.createElement("span",{className:"badge badge-pill badge-primary"},"or")),function(t,a){if("instant"===e.fieldDefinition.type){var n=(e.relativeOptions||[]).filter((function(e){return"instant"===e.fieldType}));return i.a.createElement(g,{data:t,fieldDefinition:e.fieldDefinition,relativeOptions:n,edit:r,onUpdate:function(e){return d(a,e)},onDelete:function(e){return u(a)},hideControls:!r&&a>0})}if("coding"===e.fieldDefinition.type)return i.a.createElement(h,{data:t,fieldDefinition:e.fieldDefinition,edit:r,onUpdate:function(e){return d(a,e)},onDelete:function(e){return u(a)},hideControls:!r&&a>0});if("composite"===e.fieldDefinition.type)return i.a.createElement(O,{data:t,fieldDefinition:e.fieldDefinition,edit:r,onUpdate:function(e){return d(a,e)},onDelete:function(e){return u(a)},hideControls:!r&&a>0});if("fhirId"===e.fieldDefinition.type){var l=(e.relativeOptions||[]).filter((function(e){return"fhirId"===e.fieldType}));return i.a.createElement(N,{data:t,relativeOptions:l,fieldDefinition:e.fieldDefinition,edit:r,onUpdate:function(e){return d(a,e)},onDelete:function(e){return u(a)},hideControls:!r&&a>0})}if("quantity"===e.fieldDefinition.type){var o=(e.relativeOptions||[]).filter((function(e){return"quantity"===e.fieldType}));return i.a.createElement(x,{data:t,relativeOptions:o,fieldDefinition:e.fieldDefinition,edit:r,onUpdate:function(e){return d(a,e)},onDelete:function(e){return u(a)},hideControls:!r&&a>0})}}(t,a))})),r&&i.a.createElement(j.a,{className:"text-center"},i.a.createElement(f.a,{variant:"outline-primary",size:"sm",onClick:function(){e.onUpdate(e.data.concat([k(e.fieldDefinition)]))}},"Or...")))};var I=function(e){var t="none"!==e.retentionType&&"all"!==e.retentionType&&e.retentionSortField?e.retentionType+"."+e.retentionSortField:e.retentionType||"none",a=[{name:"Don't retain matching ".concat(e.definition.name," values"),value:"none"},{name:"Retain all matching ".concat(e.definition.name," values"),value:"all"}].concat(u.a.chain(e.definition.fields).filter((function(e){return"instant"===e.type})).sortBy("name").map((function(e){return[{name:"Retain most recent match based on "+e.name,value:"latest."+e.name},{name:"Retain earliest match based on "+e.name,value:"earliest."+e.name}]})).flatten().value()),n=function(t){if(/^[a-zA-Z_]?[a-zA-Z0-9_]*$/.test(t.target.value)){var a=!t.target.value||(e.usedVars||[]).find((function(e){return e===t.target.value}));e.onChange({retentionVar:t.target.value,invalid:a})}},r=function(t){var a=t.target.value.split("."),n=Object(c.a)(a,2),i=n[0],r=n[1],l="none"!==i&&(!e.retentionVar||e.invalid);e.onChange({retentionType:i,retentionSortField:r,invalid:l})};return function(){var l=e.validate&&e.invalid,o=e.retentionVar||"";return i.a.createElement("div",{className:"container-fluid"},i.a.createElement("div",{className:"row my-1"},i.a.createElement("div",{className:"col"},i.a.createElement("select",{className:"form-control",value:t,onChange:r},a.map((function(e){return i.a.createElement("option",{key:e.value,value:e.value},e.name)}))))),"none"!==t&&i.a.createElement("div",{className:"form-row my-2"},i.a.createElement("div",{className:"col col-auto align-self-center"},"as"),i.a.createElement("div",{className:"col"},i.a.createElement("input",{value:o,placeholder:"Name",onChange:n,className:l?"is-invalid form-control":"form-control"}),l&&i.a.createElement("div",{className:"small text-danger mt-1"},"Note: variable name can't be blank and must be unique"))))}()},T=a(79),S=a(80);var V=function(e){var t=Object(n.useState)(e.data.name),a=Object(c.a)(t,2),r=a[0],l=a[1],d=Object(n.useState)(e.data.retention||{retentionType:"none"}),u=Object(c.a)(d,2),p=u[0],v=u[1],E=Object(n.useState)(e.data.rules||[]),y=Object(c.a)(E,2),b=y[0],g=y[1],h=Object(n.useState)(e.data.nextRuleId||0),N=Object(c.a)(h,2),O=N[0],x=N[1],V=Object(n.useState)(),w=Object(c.a)(V,2),U=w[0],A=w[1],R=Object(n.useState)(),F=Object(c.a)(R,2),q=F[0],P=F[1],_=Object(n.useState)(e.data.definition),B=Object(c.a)(_,2),L=B[0],M=B[1],H=Object(n.useState)(),z=Object(c.a)(H,2),Q=z[0],Z=z[1],$=function(){var t=b.filter((function(e){return e.ruleSet.filter((function(e){return!!e.invalid})).length}));t.length>0&&g(b.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{edit:e.ruleSet.filter((function(e){return!!e.invalid})).length>0,ruleSet:e.ruleSet.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{validate:!0})}))})}))),!p.invalid&&r||Z(!0),t.length>0||p.invalid||!r||e.onSave({name:r,retention:p,definition:L,parentId:e.parentId,id:e.id,nextRuleId:O,rules:b.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{edit:!1,ruleSet:e.ruleSet.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{validate:!1})}))})}))})},G=function(t,a){t&&t.preventDefault(),U&&!a&&L?P(!0):e.onClose()},J=function(){var t=e.relativeOptions.find((function(e){return"fhirId"===e.fieldType})),a=L.fields.filter((function(e){return"patient"!==e.name&&(t||"fhirId"!==e.type)}));return i.a.createElement("div",{className:"d-flex"},i.a.createElement(m.a,{title:"Add Rule",variant:"success",className:"mr-auto"},a.map((function(e){return i.a.createElement(s.a.Item,{onClick:function(t){return function(e){var t=L.fields.find((function(t){return t.name===e}));g(b.concat([{id:O,fieldName:e,edit:!0,ruleSet:[k(t)]}])),x(O+1),A(!0)}(e.name)},key:e.name},e.name)}))),i.a.createElement(f.a,{variant:"outline-danger",className:"mr-2",onClick:e.onDelete},"Delete Block"),U&&i.a.createElement(f.a,{variant:"primary",className:"mr-1",onClick:$},"Save Block"))},Y=function(){return b.map((function(t){var a=t.id,n=L.fields.find((function(e){return e.name===t.fieldName}));return i.a.createElement("div",{key:t.id},i.a.createElement(C,{fieldDefinition:n,relativeOptions:e.relativeOptions,data:t.ruleSet,edit:t.edit,onUpdate:function(e){return t=a,n=e,g(b.map((function(e){return e.id!==t?e:Object(o.a)(Object(o.a)({},e),{},{ruleSet:n})}))),void A(!0);var t,n},onDelete:function(e){return t=a,g(b.filter((function(e){return e.id!==t}))),void A(!0);var t}}))}))},K=b.filter((function(e){return e.ruleSet.filter((function(e){return!(!e.invalid||!e.validate)})).length>0})).length>0||Q&&!r||Q&&p.invalid;return i.a.createElement(T.a,{backdrop:"static",show:!0,animation:!1,onHide:G,size:"lg"},L?i.a.createElement(i.a.Fragment,null,i.a.createElement(T.a.Header,{closeButton:!0},i.a.createElement(T.a.Title,{className:"d-flex flex-grow-1"},i.a.createElement(S.a.Control,{autoFocus:!0,placeholder:"Name",value:r||"",className:Q&&!r?"is-invalid":"",onChange:function(e){l(e.target.value),A(!0)}}))),i.a.createElement(T.a.Body,null,i.a.createElement("p",null,"Block Type: ",L.name),q&&i.a.createElement("div",{className:"alert alert-danger text-center mb-4"},"You have unsaved changes -\xa0",i.a.createElement("a",{href:"#",className:"alert-link",onClick:function(e){return G(e,!0)}},"discard?")),K&&i.a.createElement("div",{className:"alert alert-danger text-center mb-4"},"Please fix the highlighted errors"),J(),Y()),i.a.createElement(T.a.Footer,null,i.a.createElement(I,Object.assign({},p,{definition:L,usedVars:e.usedVars,validate:Q,onChange:function(e){v(Object(o.a)(Object(o.a)({},p),e)),A(!0)},edit:!0})))):i.a.createElement(i.a.Fragment,null,i.a.createElement(T.a.Header,{closeButton:!0},i.a.createElement(T.a.Title,null,"Block Type")),i.a.createElement(T.a.Body,null,i.a.createElement(D.a,null,e.definitions.map((function(e,t){return i.a.createElement(j.a,{key:t,action:!0,onClick:function(t){l(e.name),M(e)}},e.name)}))))))};var w=function(e){var t=Object(p.b)("blocks","definitions"),a=t.dispatch,r=t.blocks,l=t.definitions,d=Object(n.useState)(),v=Object(c.a)(d,2),E=v[0],y=v[1],b={},g=r.concat(r.filter((function(e){return!r.find((function(t){return t.parentId===e.id}))})).map((function(e){return{id:e.id+"-end",name:e.exclude?"Exclude":"Include",parentId:e.id,isLeaf:!0}})));g.filter((function(e){return!g.find((function(t){return t.parentId===e.id}))})).forEach((function(e){return function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=g.find((function(e){return e.id===t}));b[t]?b[t].span=b[t].span+a:b[t]={id:t,span:a,name:n.name,retention:n.retention,parentId:n.parentId,isLeaf:n.isLeaf},n&&null!==n.parentId&&e(n.parentId,a)}(e.id)})),g.filter((function(e){return null===e.parentId})).forEach((function(e,t){return function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;b[t]=Object(o.a)(Object(o.a)({},b[t]),{},{id:t,row:a,col:n});var i=n;g.filter((function(e){return e.parentId===t})).forEach((function(t){e(t.id,a+1,i),i+=b[t.id].span}))}(e.id,1,1)}));var h=g.reduce((function(e,t){var a=b[t.id];return Math.max(e,a.col+a.span)}),0),N=g.reduce((function(e,t){return Math.max(e,b[t.id].row)}),0),O=function(e){a("block/upsert",{block:e,insertAbove:E&&E.insertAbove||void 0}),y(null)},D=function(){void 0!==E.id&&a("block/delete",E),y(null)};return i.a.createElement("div",null,i.a.createElement("div",{className:"container-fluid split"},i.a.createElement("table",{className:"m-4"},i.a.createElement("tbody",null,u.a.range(1,N+1).map((function(e){var t=0;return i.a.createElement("tr",{key:e,className:"",style:{height:"100%"}},u.a.range(1,h).map((function(a){if(!t){var n=u.a.find(b,(function(t){return t.row===e&&t.col===a}));return n?(t=n.span-1,function(e,t,a){var n="btn m-2 p-4 flex-grow-1 block-button text-dark "+(("Include"===a.name?"btn-outline-success":"Exclude"===a.name&&"btn-outline-danger")||"btn-outline-primary"),r=a.retention&&"none"!==a.retention.retentionType?"retain ".concat(a.retention.retentionType," as ").concat(a.retention.retentionVar):"",l=r?i.a.createElement("span",null,a.name,i.a.createElement("br",null),"\u2193",i.a.createElement("br",null),r):a.name;return i.a.createElement("td",{key:e+":"+t,colSpan:a.span,className:"text-center",style:{height:"1px"}},i.a.createElement("div",{className:"h-100 w-100 d-flex flex-column"},1!==e&&!a.isLeaf&&i.a.createElement("div",null,i.a.createElement(m.a,{title:"\u2193",size:"sm",variant:"outline-primary",className:"m-2 no-caret"},i.a.createElement(s.a.Item,{href:"#",onClick:function(e){return y({parentId:a.parentId})}},"Add Branch"),i.a.createElement(s.a.Item,{href:"#",onClick:function(e){return y({parentId:a.parentId,insertAbove:a.id})}},"Insert Block"))),a.isLeaf&&i.a.createElement("div",null,i.a.createElement(f.a,{size:"sm",variant:"outline-primary",className:"m-2",onClick:function(e){return y({parentId:a.parentId})}},"\u2193")),i.a.createElement("button",{className:n,onClick:function(e){a.isLeaf?O({id:a.parentId,exclude:"Exclude"!==a.name}):"root"===a.id||a.isLeaf||y({id:a.id,parentId:a.parentId})}},l)))}(e,a,n)):i.a.createElement("td",{key:e+":"+a})}t-=1})))}))))),E&&function(){var e=r.find((function(e){return e.id===E.id}))||{},t=e.retention&&"none"!==e.retention.retentionType?e.retention.retentionVar:"",a=r.filter((function(e){return e.retention&&"none"!==e.retention.retentionType&&e.retention.retentionVar&&e.retention.retentionVar!==t})).map((function(e){return e.retention.retentionVar})),n=null!==e.parentId?function e(t,a){var n=[],i=a.find((function(e){return e.id===t}));return i.retention&&i.retention.retentionVar&&i.definition.fields.forEach((function(e){"composite"===e.type&&i.rules.forEach((function(t){t.ruleSet.forEach((function(t){t.name&&e.fields.forEach((function(e){n.push({retentionVar:i.retention.retentionVar,compositeName:t.name,fieldType:e.type,fieldName:e.name,value:[i.id,t.name,e.name].join("."),label:[i.retention.retentionVar,t.name,e.name].join(".")})}))}))})),"composite"!==e.type&&n.push({retentionVar:i.retention.retentionVar,fieldType:e.type,fieldName:e.name,value:[i.id,e.name].join("."),label:[i.retention.retentionVar,e.name].join(".")})})),null!==i.parentId?n.concat(e(i.parentId,a)):n}(E.parentId,r):[];return i.a.createElement(V,{id:E.id,parentId:E.parentId,data:e,definitions:l,usedVars:a,onClose:function(e){return y(null)},relativeOptions:n,onSave:O,onDelete:D})}())};var U=function(){return i.a.createElement(w,null)},A=a(52),R=[{name:"Lab Result - Numerical",version:"1.0.0.alpha",fields:[{name:"patient",type:"fhirId",field:"ptId",exprSuffix:"subject.type = 'Patient'"},{name:"id",type:"fhirId",field:"rId"},{name:"status",type:"coding",field:"status",editable:!1,options:[{values:[{code:"registered"}],name:"Registered"},{values:[{code:"preliminary"}],name:"Preliminary"},{values:[{code:"final"}],name:"Final"},{values:[{code:"amended"}],name:"Amended"},{values:[{code:"corrected"}],name:"- Corrected"},{values:[{code:"cancelled"}],name:"Cancelled"},{values:[{code:"entered-in-error"}],name:"Entered in Error"},{values:[{code:"unknown"}],name:"Unknown"}]},{name:"effectiveDateTimeStart",type:"instant",field:"effectiveDateTimeStart"},{name:"effectiveDateTimeEnd",type:"instant",field:"effectiveDateTimeEnd"},{name:"valueQuantity",type:"quantity",field:"valueQuantity"},{name:"code",type:"coding",field:"code"},{name:"dataAbsentReason",type:"coding",field:"dataAbsentReason",editable:!0,options:[{values:[{code:"unknown"}],name:"Unknown"},{values:[{code:"asked-unknown"}],name:"-  Asked But Unknown"},{values:[{code:"temp-unknown"}],name:"-  Temporarily Unknown"},{values:[{code:"not-asked"}],name:"  Not Asked"},{values:[{code:"asked-declined"}],name:"-  Asked But Declined"},{values:[{code:"masked"}],name:"Masked"},{values:[{code:"not-applicable"}],name:"Not Applicable"},{values:[{code:"unsupported"}],name:"Unsupported"},{values:[{code:"as-text"}],name:"As Text"},{values:[{code:"error"}],name:"Error"},{values:[{code:"not-a-number"}],name:"-  Not a Number"},{values:[{code:"negative-infinity"}],name:"-  Negative Infinity"},{values:[{code:"positive-infinity"}],name:"-  Positive Infinity"},{values:[{code:"not-performed"}],name:"Not Performed"},{values:[{code:"not-permitted"}],name:"Not Permitted"}]}]},{name:"Condition",version:"1.0.0.alpha",fields:[{name:"patient",type:"fhirId",field:"ptId",exprSuffix:"subject.type = 'Patient'"},{name:"id",type:"fhirId",field:"rId"},{name:"clinicalStatus",type:"coding",field:"clinicalStatus",editable:!1,options:[{values:[{code:"active"}],name:"Active"},{values:[{code:"recurrence"}],name:"- Recurrence"},{values:[{code:"relapse"}],name:"- Relapse"},{values:[{code:"inactive"}],name:"Inactive"},{values:[{code:"remission"}],name:"- Remission"},{values:[{code:"resolved"}],name:"- Resolved"}]},{name:"verificationStatus",type:"coding",field:"verificationStatus",editable:!1,options:[{values:[{code:"unconfirmed"}],name:"Unconfirmed"},{values:[{code:"provisional"}],name:"- Provisional"},{values:[{code:"differential"}],name:"- Differential"},{values:[{code:"confirmed"}],name:"Confirmed"},{values:[{code:"refuted"}],name:"Refuted"},{values:[{code:"entered-in-error"}],name:"Entered in Error"}]},{name:"category",type:"coding",field:"category",editable:!1,options:[{values:[{code:"problem-list-item"}],name:"Problem List Item"},{values:[{code:"encounter-diagnosis"}],name:"Encounter Diagnosis"},{values:[{code:"health-concern"}],name:"Health Concern"}]},{name:"code",type:"coding",field:"code"}]},{name:"Demographics",version:"1.0.0.alpha",fields:[{name:"patient",type:"fhirId",field:"id"},{name:"id",type:"fhirId",field:"rId"},{name:"gender",type:"coding",field:"gender",editable:!1,options:[{values:[{code:"male"}],name:"Male"},{values:[{code:"female"}],name:"Female"},{values:[{code:"other"}],name:"Other"},{values:[{code:"unknown"}],name:"Unknown"}]},{name:"birthDate",type:"instant",field:"birthDate"},{name:"usCoreRace",type:"coding",field:"usCoreRace"},{name:"usCoreEthnicity",type:"coding",field:"usCoreEthnicity"}]}],F={nextId:7,definitions:R,blocks:[{id:"root",name:"All Patients",parentId:null},{name:"Demographics",retention:{retentionType:"all",retentionVar:"pt"},definition:R[2],parentId:"root",id:0,nextRuleId:0,rules:[]},{name:"DM Dx",definition:R[1],retention:{retentionType:"none"},parentId:0,id:1,nextRuleId:1,rules:[{id:0,fieldName:"code",ruleSet:[{name:"SNOMED DM",system:"http://snomed.info/sct",code:"105401000119101,106281000119103,10754881000119104,111307005,111552007,123763000,127012008,1481000119100,190330002,190331003,190368000,190372001,190389009,190406000,190407009,190410002,190411003,190412005,199223000,199225007,199226008,199227004,199228009,199229001,199230006,199231005,23045005,237599002,237600004,237601000,237604008,237613005,237618001,237619009,237627000,237651005,24203005,2751001,28032008,31321000119102,313435000,313436004,314771006,314893005,314902007,314903002,314904008,33559001,359642000,368521000119107,408539000,426705001,426875007,427089005,42954008,44054006,445260006,46635009,4783006,51002006,530558861000132104,57886004,59079001,5969009,609561005,609562003,609563008,609564002,609566000,609567009,609568004,609569007,609570008,609571007,609572000,609573005,609574004,609575003,609576002,609577006,609578001,70694009,709147009,710815001,716362006,71791000119104,719216001,720519003,722454003,724136006,73211009,733072002,734022008,75524006,75682002,76751001,81531005,8801005,91352004,9859006"}]}]},{name:"Most Recent A1C",retention:{retentionType:"latest",retentionSortField:"effectiveDateTimeEnd",retentionVar:"a1c_2"},definition:R[0],parentId:1,id:2,nextRuleId:2,rules:[{id:0,fieldName:"status",ruleSet:[{invalid:!1,option:"Final",validate:!1},{invalid:!1,option:"Amended",validate:!1},{invalid:!1,option:"- Corrected",validate:!1}]},{id:1,fieldName:"code",ruleSet:[{system:"http://loinc.org",code:"4548-4"}]}]},{name:"Most Recent A1C Elevated",retention:{retentionType:"none"},definition:R[0],parentId:2,id:3,nextRuleId:2,rules:[{id:0,fieldName:"id",edit:!1,ruleSet:[{invalid:!1,target:"2.id",validate:!1}]},{id:1,fieldName:"valueQuantity",edit:!1,ruleSet:[{comparator:"gte",compareTo:"fixed",fixedValue:"7",offsetDir:"plus",offsetValue:0,validate:!1}]}]},{name:"Penultimate A1C",retention:{retentionType:"latest",retentionSortField:"effectiveDateTimeEnd",retentionVar:"a1c_1"},definition:R[0],parentId:3,id:4,nextRuleId:4,rules:[{id:0,fieldName:"status",ruleSet:[{invalid:!1,option:"Final",validate:!1},{invalid:!1,option:"Amended",validate:!1},{invalid:!1,option:"- Corrected",validate:!1}]},{id:1,fieldName:"effectiveDateTimeStart",edit:!1,ruleSet:[{invalid:!1,comparator:"lt",compareTo:"2.effectiveDateTimeStart",offsetUnit:"months",offsetDir:"minus",offsetValue:"1",validate:!1}]},{id:2,fieldName:"effectiveDateTimeStart",edit:!1,ruleSet:[{invalid:!1,comparator:"gte",compareTo:"0.birthDate",fixedValue:"2020-01-01",offsetUnit:"years",offsetDir:"plus",offsetValue:"18",validate:!1}]},{id:3,fieldName:"code",ruleSet:[{system:"http://loinc.org",code:"4548-4"}]}]},{name:"Penultimate A1C Elevated",retention:{retentionType:"none"},definition:R[0],parentId:4,id:5,nextRuleId:2,rules:[{id:0,fieldName:"id",edit:!1,ruleSet:[{invalid:!1,target:"4.id",validate:!1}]},{id:1,fieldName:"valueQuantity",edit:!1,ruleSet:[{comparator:"gte",compareTo:"fixed",fixedValue:"7",offsetDir:"plus",offsetValue:0,validate:!1}]}]},{name:"HTN Dx",retention:{retentionType:"none"},definition:R[1],parentId:"root",id:7,nextRuleId:2,exclude:!0,rules:[{id:0,fieldName:"clinicalStatus",ruleSet:[{invalid:!1,option:"Active",validate:!1}]},{id:1,fieldName:"verificationStatus",ruleSet:[{option:"Confirmed"}]},{id:2,fieldName:"code",ruleSet:[{system:"http://snomed.info/sct",name:"SNOMED",code:"10725009, 10964002, 1201005, 123799005, 59621000"},{name:"ICD-9",system:"http://hl7.org/fhir/ValueSet/icd-9",code:"401.1, 401.9"}]}]}]},q={nextId:1,definitions:R,blocks:[{id:"root",name:"All Patients",parentId:null}]},P=Object(A.a)([function(e){e.on("@init",(function(){return/example=true/.test(window.location.search)?F:q})),e.on("block/upsert",(function(e,t){var a=e.nextId,n=e.blocks,i=t.block,r=t.insertAbove,l=void 0===i.id?{nextId:a+1,blocks:n.map((function(e){return e.id===r?Object(o.a)(Object(o.a)({},e),{},{parentId:a+1}):e})).concat([Object(o.a)(Object(o.a)({},i),{},{id:a+1})])}:{blocks:n.map((function(e){return i.id!==e.id?e:Object(o.a)(Object(o.a)({},e),i)}))};return console.log(i),l})),e.on("block/delete",(function(e,t){var a=e.blocks,n=t.id,i=t.parentId;return{blocks:a.map((function(e){return e.parentId===n?Object(o.a)(Object(o.a)({},e),{},{parentId:i}):e})).filter((function(e){return e.id!==n}))}}))}]);l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(p.a.Provider,{value:P},i.a.createElement(U,null))),document.getElementById("root"))}},[[58,1,2]]]);
//# sourceMappingURL=main.4d507945.chunk.js.map