{"version":3,"sources":["DateRule.js","CodingRule.js","IdRule.js","CompositeRule.js","QuantityRule.js","RuleSet.js","Retention.js","BlockEditor.js","BlockChart.js","App.js","definitions.js","dm-example.js","store.js","index.js"],"names":["DateRule","props","options","comparator","value","display","compareTarget","offsetDir","offsetUnit","handleChange","field","newData","data","invalid","fixedValue","indexOf","compareTo","test","validateDateProperties","onUpdate","mapOptions","property","map","o","key","simpleComparator","edit","className","fieldDefinition","name","hideControls","icon","faTrashAlt","opacity","onClick","e","onDelete","id","style","cursor","pull","onChange","target","invalidDate","validate","Col","relativeOptions","sort","r","label","type","required","renderCompareTarget","offsetValue","renderOffset","findOption","find","compareToLabel","faEdit","lineHeight","toLowerCase","renderDisplay","CodingRule","code","option","replace","length","validateCodingProperties","renderHeader","selection","system","codeCount","split","codeText","buildOptionDisplay","editable","renderOptionSelector","placeholder","IdRule","targetLabel","paddingLeft","textIndent","CompositeRule","handleUpdateRule","ruleData","children","i","filter","handleNameChange","fields","f","fieldType","renderRule","QuantityRule","unitCode","trim","unitSystem","validateQuantityProperties","invalidValue","invalidUnitSystem","invalidUnitCode","xs","getRuleDefaults","defaults","RuleSet","useState","setEdit","pos","handleDeleteRule","ListGroup","ListGroupItem","Button","variant","size","rule","concat","Retention","retentionValue","retentionType","retentionSortField","retentionOptions","definition","_","chain","sortBy","flatten","handleVarChange","usedVars","v","retentionVar","handleValueChange","errors","renderEdit","BlockEditor","setName","retention","setRetention","rules","setRules","nextRuleId","setNextRuleId","isDirty","setIsDirty","dirtyWarning","setDirtyWarning","setDefinition","setValidate","handleSaveBlock","invalidRules","ruleSet","rs","onSave","parentId","handleClose","force","preventDefault","onClose","idJoinOptions","ddFields","DropdownButton","title","Dropdown","Item","fieldName","d","addRule","renderRules","ruleId","newRule","hasErrors","Modal","backdrop","show","animation","onHide","Header","closeButton","Title","Form","Control","autoFocus","Body","href","Footer","newRetention","definitions","block","action","BlockChart","useStoreon","dispatch","blocks","activeInstance","setActiveInstance","cells","blockList","b","node","exclude","isLeaf","bi","child","forEach","walkUp","span","walkDown","row","col","nextCol","colCount","reduce","acc","cell","Math","max","rowCount","saveBlock","insertAbove","undefined","deleteBlock","range","skip","height","c","cellStyles","retentionText","colSpan","renderCell","getRelativeOptions","blockId","childField","push","compositeName","join","renderModal","App","defaultState","store","createStoreon","on","window","location","search","dmExample","nextId","result","console","log","ReactDOM","render","StrictMode","Provider","document","getElementById"],"mappings":"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","file":"static/js/main.4d507945.chunk.js","sourcesContent":["import React from 'react';\nimport { Col }  from \"react-bootstrap\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faEdit, faTrashAlt } from '@fortawesome/free-solid-svg-icons'\n\n\nfunction DateRule(props) {\n\tconst options = {\n\t\tcomparator: [\n\t\t\t{value: \"populated\", display: \"Populated\"},\n\t\t\t{value: \"not_populated\", display: \"Not Populated\"},\n\t\t\t{value: \"eq\", display: \"Equal To\"},\n\t\t\t{value: \"lt\", display: \"Before\"},\n\t\t\t{value: \"lte\", display: \"Before (Inclusive)\"},\n\t\t\t{value: \"gt\", display: \"After\"},\n\t\t\t{value: \"gte\", display: \"After (Inclusive)\"}\n\t\t],\n\t\tcompareTarget: [\n\t\t\t{value: \"run\", display: \"Query Run Date\"},\n\t\t\t{value: \"fixed\", display: \"Fixed Date\"}\n\t\t],\n\t\toffsetDir: [\n\t\t\t{value: \"plus\", display: \"+\"},\n\t\t\t{value: \"minus\", display: \"-\"}\n\t\t],\n\t\toffsetUnit: [\n\t\t\t{value: \"minutes\", display: \"Minutes\"},\n\t\t\t{value: \"hours\", display: \"Hours\"},\n\t\t\t{value: \"days\", display: \"Days\"},\n\t\t\t{value: \"months\", display: \"Months\"},\n\t\t\t{value: \"years\", display: \"Years\"}\n\t\t]\n\t}\n\n\tconst handleChange = (field, value) => {\n\t\tconst newData = {...props.data, [field]: value};\n\t\tconst invalid = validateDateProperties(newData);\n\t\tprops.onUpdate({...newData, invalid});\n\t}\n\n\tconst mapOptions = (property) => {\n\t\treturn options[property].map( o => {\n\t\t\treturn <option value={o.value} key={o.value}>{o.display}</option>\n\t\t});\n\t};\n\n\tconst renderHeader = () => <div className=\"my-2\">\n\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t<span>is</span>\n\t\t{!props.hideControls && <FontAwesomeIcon \n\t\t\ticon={faTrashAlt} opacity=\"0.5\"\n\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\tpull=\"right\" \n\t\t/>}\n\t</div>\n\n\tconst renderComparator = () => <div className=\"my-2\">\n\t\t<select className=\"form-control\"\n\t\t\tvalue={props.data.comparator || \"gt\"} \n\t\t\tonChange={e => handleChange(\"comparator\", e.target.value)}\n\t\t>{mapOptions(\"comparator\")}</select>\n\t</div>\n\n\tconst renderCompareTarget = () => {\n\t\tconst invalidDate = props.data.validate && props.data.invalid;\n\t\treturn <div className=\"my-2 form-row\">\n\t\t\t<Col>\n\t\t\t\t<select className=\"form-control\"\n\t\t\t\t\tvalue={props.data.compareTo || \"fixed\"} \n\t\t\t\t\tonChange={e => handleChange(\"compareTo\", e.target.value)}\n\t\t\t\t>{mapOptions(\"compareTarget\")}\n\t\t\t\t\t{(props.relativeOptions || []).sort().map( r => {\n\t\t\t\t\t\treturn <option key={r.value} value={r.value}>{r.label}</option>\n\t\t\t\t\t})}\n\t\t\t\t</select>\n\t\t\t</Col>\n\t\t\t{(!props.data.compareTo || props.data.compareTo === \"fixed\") && <Col>\n\t\t\t\t<input type=\"date\" className=\"form-control\"\n\t\t\t\t\trequired={true} \n\t\t\t\t\tvalue={props.data.fixedValue || \"\"} \n\t\t\t\t\tonChange={e => handleChange(\"fixedValue\", e.target.value)}\n\t\t\t\t\tclassName={invalidDate ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t/>\n\t\t\t</Col>}\n\t\t</div>\n\t}\n\n\tconst renderCompareOffset = () => <div className=\"my-2 form-row\"><Col>\n\t\t<select className=\"form-control\"\n\t\t\tvalue={props.data.offsetDir || \"plus\"} \n\t\t\tonChange={e => handleChange(\"offsetDir\", e.target.value)}\n\t\t>{mapOptions(\"offsetDir\")}</select>\n\t</Col><Col>\n\t\t<input type=\"number\" className=\"form-control\"\n\t\t\tvalue={props.data.offsetValue || \"\"}  required={true}\n\t\t\tonChange={e => handleChange(\"offsetValue\", e.target.value)}\n\t\t/>\n\t</Col><Col>\n\t\t<select className=\"form-control\"\n\t\t\tvalue={props.data.offsetUnit || \"years\"} \n\t\t\tonChange={e => handleChange(\"offsetUnit\", e.target.value)}\n\t\t>{mapOptions(\"offsetUnit\")}</select>\n\t</Col></div>\n\n\tconst simpleComparator = props.data.comparator &&\n\t\tprops.data.comparator.indexOf(\"populated\") !== -1;\n\n\tconst renderDisplay = () => {\n\n\t\tconst renderOffset = () => {\n\t\t\tif (!props.data.offsetValue) return;\n\t\t\treturn <span className=\"mr-1 mt-1 mark\">\n\t\t\t\t{findOption(\"offsetDir\", props.data.offsetDir)}\n\t\t\t\t{\" \"}{props.data.offsetValue}{\" \"}\n\t\t\t\t{findOption(\"offsetUnit\", props.data.offsetUnit)}\n\t\t\t</span>\n\t\t};\n\n\t\tconst findOption = (property, value) => {\n\t\t\treturn options[property].find( o => o.value === value).display;\n\t\t}\n\n\t\tconst compareToLabel = !simpleComparator && props.data.compareTo.indexOf(\".\") > -1 &&\n\t\t\tprops.relativeOptions.find( r => r.value === props.data.compareTo ).label;\n\n\t\treturn <div>\n\t\t\t{!props.hideControls && \n\t\t\t\t<FontAwesomeIcon icon={faEdit} opacity=\"0.5\" style={{cursor: \"pointer\"}} pull=\"right\" className=\"m-1\" />\n\t\t\t}\n\t\t\t\n\t\t\t<div style={{lineHeight: 2}}>\n\t\t\t\t<span className=\"mt-1 mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t<span className=\"mt-1 mr-1\">is</span>\n\t\t\t\t<span className=\"mt-1 mr-1 mark\">\n\t\t\t\t\t{findOption(\"comparator\", props.data.comparator).toLowerCase()}\n\t\t\t\t</span>\n\n\t\t\t\t{!simpleComparator && props.data.compareTo === \"fixed\" && <>\n\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">fixed value</span>\n\t\t\t\t\t<span className=\"mt-1 mr-1\">of</span>\t\n\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">{props.data.fixedValue}</span>\n\t\t\t\t</>}\n\n\t\t\t\t{!simpleComparator && props.data.compareTo === \"run\" && <>\n\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">Query Run Date</span>\n\t\t\t\t\t{renderOffset()}\n\t\t\t\t</>}\n\n\t\t\t\t{!simpleComparator && props.data.compareTo.indexOf(\".\") > -1 && <>\n\t\t\t\t\t<span className=\"d-inline-block\">\n\t\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">{compareToLabel}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t{renderOffset()}\n\t\t\t\t</>}\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\tconst renderEdit = () => <>\n\t\t{ renderHeader() }\n\t\t{ renderComparator() }\n\t\t{ !simpleComparator && renderCompareTarget() }\n\t\t{ !simpleComparator && props.data.compareTo !== \"fixed\" && renderCompareOffset() }\n\t</>\n\n\treturn props.edit ? renderEdit() : renderDisplay();\n\t\n}\n\n//return invalid params\nfunction validateDateProperties(data) {\n\tconst fixedValue = data.comparator.indexOf(\"populated\") === -1 &&\n\t\tdata.compareTo === \"fixed\" &&\n\t\t!/^\\d{4}-\\d{2}-\\d{2}$/.test(data.fixedValue)\n\treturn fixedValue && {fixedValue}\n\t\n}\n\nfunction defaultDateProperties() {\n\treturn {\n\t\tcomparator: \"gte\", compareTo: \"fixed\", \n\t\tfixedValue: \"2020-01-01\", offsetUnit: \"years\",\n\t\toffsetDir: \"plus\", offsetValue: 0, invalid: false\n\t}\n}\n\nexport default DateRule;\nexport {defaultDateProperties};","import React from \"react\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faEdit, faTrashAlt, faCheck } from '@fortawesome/free-solid-svg-icons'\n\n\nfunction CodingRule(props) {\n\n\tfunction validateCodingProperties(newData) {\n\t\tconst code = (!props.fieldDefinition.options || newData.option === \"__custom\") &&\n\t\t\t(newData.code || \"\").replace(/[\\s,]/g).length === 0\n\t\treturn code && {code}\n\t}\n\n\tconst handleChange = (field, value) => {\n\t\tconst newData = {...props.data, [field]: value};\n\t\tconst invalid = validateCodingProperties(newData);\n\t\tprops.onUpdate({...newData, invalid});\n\t}\n\n\tconst renderOptionSelector = () => {\n\t\tconst selection = (\n\t\t\tprops.fieldDefinition.options.find( o => {\n\t\t\t\treturn o.name === props.data.name && o.system === props.data.system && o.code === props.data.code\n\t\t\t})\n\t\t|| {}).name;\n\n\t\tconst buildOptionDisplay = (o) => {\n\t\t\tconst codeCount = (o.code || \"\").split(\",\").length;\n\t\t\tconst codeText = codeCount > 1 ? ` (${codeCount} codes)` : \"\";\n\t\t\treturn o.name + codeText;\n\t\t};\n\n\t\treturn <div>\n\t\t\t<div className=\"my-2\">\n\t\t\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t<span>is</span>\n\t\t\t\t{!props.hideControls && <FontAwesomeIcon icon={faTrashAlt} opacity=\"0.5\"\n\t\t\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\t\t\tpull=\"right\" \n\t\t\t\t/>}\n\t\t\t</div>\n\n\t\t\t<select value={(props.data.option) || \"\"} \n\t\t\t\tonChange={e => handleChange(\"option\", e.target.value)} \n\t\t\t\tclassName={props.data.invalid && props.data.validate ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t>\n\t\t\t\t{!selection && <option value=\"\"></option>}\n\t\t\t\t{props.fieldDefinition.options.map( o => <option value={o.name} key={o.name}>\n\t\t\t\t\t{buildOptionDisplay(o)}\n\t\t\t\t</option> )}\n\t\t\t\t{props.fieldDefinition.editable && <option value=\"__custom\" key=\"__custom\">Custom</option>}\n\t\t\t</select>\n\t\t</div>\n\t}\n\n\tconst renderCustomEdit = () => {\n\t\treturn <div>\n\t\t\t{ renderHeader() }\n\t\t\t<div className=\"form-group\">\n\t\t\t\t<label>Name (optional)</label>\n\t\t\t\t<input className=\"form-control\" value={props.data.name || \"\"}\n\t\t\t\t\tonChange={e => handleChange(\"name\", e.target.value)}\n\t\t\t\t/>\n\t\t\t</div><div className=\"form-group\">\n\t\t\t\t<label>System (optional)</label>\n\t\t\t\t<input className=\"form-control\" value={props.data.system || \"\"}\n\t\t\t\t\tplaceholder=\"http://loinc.org\"\n\t\t\t\t\tonChange={e => handleChange(\"system\", e.target.value)}\n\t\t\t\t/>\n\t\t\t</div><div className=\"form-group\">\n\t\t\t\t<label>Codes (comma separated)</label>\n\t\t\t\t<textarea value={props.data.code || \"\"}\n\t\t\t\t\tonChange={e => handleChange(\"code\", e.target.value)}\n\t\t\t\t\tclassName={props.data.invalid && props.data.validate ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\tconst renderHeader = () => <div className=\"my-2\">\n\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t<span>matches at least one code in</span>\n\t\t{!props.hideControls && <FontAwesomeIcon icon={faTrashAlt} opacity=\"0.5\"\n\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\tpull=\"right\" \n\t\t/>}\n\t</div>\n\n\tconst renderEdit = () => {\n\t\tconst isCustom = props.data.option === \"__custom\" || !props.fieldDefinition.options;\n\t\treturn isCustom ? renderCustomEdit() : renderOptionSelector();\n\t}\n\n\tconst renderDisplay = () => {\n\t\tconst codeCount = props.data.code ? props.data.code.split(\",\").length : 0;\n\t\tconst name = (props.data.option && props.data.option !== \"__custom\" && props.data.option.replace(/^[ -]*/, \"\")) ||\n\t\t\tprops.data.name || \n\t\t\t(codeCount === 1 && props.data.code) ||\n\t\t\t\"Unnamed\";\n\n\t\treturn \t<div>\n\t\t\t{!props.hideControls && \n\t\t\t\t<FontAwesomeIcon icon={faEdit} opacity=\"0.5\"\n\t\t\t\t\t style={{cursor: \"pointer\"}} pull=\"right\" className=\"m-1\" \n\t\t\t\t/>\n\t\t\t}\n\t\t\t<div style={{lineHeight: 2}}>\n\t\t\t\t<span className=\"mt-1 mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t{codeCount > 1 ? \" matches at least one code in valueset \" : \" matches code \"}\n\t\t\t\t<span className=\"mark mt-1\">{name}</span>\n\t\t\t\t{codeCount > 1 && <span className=\"mt-1\">({codeCount} codes)</span>}\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\n\t}\n\treturn props.edit ? renderEdit() : renderDisplay();\n\t\n}\n\nfunction defaultCodingProperties() {\n\treturn {invalid: {code: true}}\n}\n\nexport default CodingRule;\nexport { defaultCodingProperties };","import React from \"react\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faEdit, faTrashAlt } from '@fortawesome/free-solid-svg-icons'\n\n\nfunction IdRule(props) {\n\n\tconst handleChange = (field, value) => {\n\t\tconst newData = {...props.data, [field]: value};\n\t\tprops.onUpdate({...newData, invalid: false});\n\t}\n\n\tconst renderEdit = () => {\n\t\treturn <div>\n\t\t\t<div className=\"my-2\">\n\t\t\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t<span>is equal to</span>\n\t\t\t\t{!props.hideControls && <FontAwesomeIcon icon={faTrashAlt} opacity=\"0.5\"\n\t\t\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\t\t\tpull=\"right\" \n\t\t\t\t/>}\n\t\t\t</div>\n\t\t\t<select value={props.data.target} \n\t\t\t\tclassName={props.data.validate && !props.data.target ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\tonChange={e => handleChange(\"target\", e.target.value)}\n\t\t\t>\n\t\t\t\t{ !props.data.target && <option key=\"\" value=\"\"></option>}\n\t\t\t\t{(props.relativeOptions || []).sort().map( r => {\n\t\t\t\t\treturn <option key={r.value} value={r.value}>{r.label}</option>\n\t\t\t\t})}\n\t\t\t</select>\n\t\t</div>\n\t}\n\n\tconst renderDisplay = () => {\n\t\tconst targetLabel = props.data.target \n\t\t\t? props.relativeOptions.find( r => r.value === props.data.target ).label\n\t\t\t: \"\";\n\t\treturn <div>\n\t\t\t{!props.hideControls && \n\t\t\t\t<FontAwesomeIcon icon={faEdit} opacity=\"0.5\" style={{cursor: \"pointer\"}} pull=\"right\" className=\"m-1\" />\n\t\t\t}\n\t\t\t<div style={{lineHeight: 2, paddingLeft: \"24px\", textIndent: \"-24px\"}}>\n\t\t\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t<span className=\"mr-1\">is equal to</span>\n\t\t\t\t<span className=\"mr-1 mark\">{targetLabel}</span>\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\treturn props.edit ? renderEdit() : renderDisplay();\n\t\n}\n\nexport default IdRule;\n","import React, {useState} from \"react\";\nimport DateRule from \"./DateRule\";\nimport CodingRule from \"./CodingRule\";\nimport IdRule from \"./IdRule\";\nimport { Modal, Button, DropdownButton, Dropdown, Form, Container, Row, Col, Card, ListGroup, ListGroupItem }  from \"react-bootstrap\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faEdit, faTrashAlt, faCheck } from '@fortawesome/free-solid-svg-icons'\n\nfunction CompositeRule(props) {\n\n\tconst handleUpdateRule = (id, ruleData) => {\n\t\tlet children = props.data.children.map( (r, i) => {\n\t\t\treturn i === id ? ruleData : r\n\t\t})\n\t\tif (id > children.length-1) children[id] = ruleData;\n\t\tconst invalid = children.filter( r => r.invalid ? true : false ).length > 0;\n\t\tprops.onUpdate({...props.data, children, invalid});\n\t}\n\n\tconst handleNameChange = e => {\n\t\tif (/^[a-zA-Z_]?[a-zA-Z0-9_]*$/.test(e.target.value))\n\t\t\tprops.onUpdate({...props.data, name: e.target.value});\n\t}\n\tconst renderRule = (ruleData, fieldDefinition, i) => {\n\t\tif (fieldDefinition.type === \"instant\") {\n\t\t\tconst relativeOptions = (props.relativeOptions||[]).filter( r => r.type === \"instant\" );\n\t\t\treturn <DateRule \n\t\t\t\tdata={{...ruleData, validate: props.data.validate}}\n\t\t\t\tfieldDefinition={fieldDefinition} \n\t\t\t\trelativeOptions={relativeOptions}\n\t\t\t\tedit={props.edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\thideControls={true}\n\t\t\t/>\n\t\t} else if (fieldDefinition.type === \"coding\") {\n\t\t\treturn <CodingRule \n\t\t\t\tdata={{...ruleData, validate: props.data.validate}}\n\t\t\t\tfieldDefinition={fieldDefinition} \n\t\t\t\tedit={props.edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\thideControls={true}\n\t\t\t/>\n\t\t} else if (props.fieldDefinition.type === \"fhirId\") {\n\t\t\tconst relativeOptions = (props.relativeOptions||[]).filter( r => r.fieldType === \"fhirId\" );\n\t\t\treturn <IdRule \n\t\t\t\trelativeOptions={relativeOptions}\n\t\t\t\tdata={{...ruleData, validate: props.data.validate}}\n\t\t\t\tfieldDefinition={fieldDefinition} \n\t\t\t\tedit={props.edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\thideControls={true}\n\t\t\t/>\n\t\t}\n\t}\n\n\tconst renderHeaderEdit = () => {\n\t\treturn <div>\n\t\t\t<span className=\"font-weight-bold\">\n\t\t\t\t{props.fieldDefinition.name}\n\t\t\t</span>\n\t\t\t<FontAwesomeIcon icon={faTrashAlt} \n\t\t\t\topacity=\"0.5\"\n\t\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\t\tpull=\"right\"\n\t\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\t/>\n\t\t\t<div className=\"my-2\">\n\t\t\t\t<input type=\"text\" className=\"form-control\" \n\t\t\t\t\tplaceholder=\"Rule Name (letters, numbers or underscore)\"\n\t\t\t\t\tvalue={props.data.name || \"\"}\n\t\t\t\t\tonChange={handleNameChange}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\tconst renderHeaderDisplay = () => {\n\t\treturn <div className=\"d-flex justify-content-between align-items-top\">\n\t\t\t<span className=\"font-weight-bold\">\n\t\t\t\t{props.fieldDefinition.name}{\" \"}\n\t\t\t\t(<span className=\"mark\">{props.data.name || \"Unnamed\"}</span>)\n\t\t\t</span>\n\t\t\t{!props.hideControls &&\n\t\t\t\t<FontAwesomeIcon icon={faEdit} opacity=\"0.5\" style={{cursor: \"pointer\"}} className=\"m-1\" />\n\t\t\t}\n\t\t</div>\n\t}\n\n\treturn <>\n\t\t{ props.edit ? renderHeaderEdit() : renderHeaderDisplay() }\n\t\t{props.fieldDefinition.fields.map( (f, i) => {\n\t\t\treturn <div key={i} className=\"ml-4 my-3\">\n\t\t\t\t{ renderRule(props.data.children[i], f, i) }\n\t\t\t</div>\n\t\t})}\t\t\n\t</>\n\n\n}\n\nexport default CompositeRule;","import React from 'react';\nimport { Col }  from \"react-bootstrap\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faEdit, faTrashAlt } from '@fortawesome/free-solid-svg-icons'\n\nfunction QuantityRule(props) {\n\n\tconst options = {\n\t\tcomparator: [\n\t\t\t{value: \"populated\", display: \"Populated\"},\n\t\t\t{value: \"not_populated\", display: \"Not Populated\"},\n\t\t\t{value: \"eq\", display: \"Equal To\"},\n\t\t\t{value: \"lt\", display: \"Less then\"},\n\t\t\t{value: \"lte\", display: \"Less than or equal to\"},\n\t\t\t{value: \"gt\", display: \"Greater than\"},\n\t\t\t{value: \"gte\", display: \"Greater than or equal to\"}\n\t\t],\n\t\tcompareTarget: [\n\t\t\t{value: \"fixed\", display: \"Fixed Value of\"}\n\t\t],\n\t\toffsetDir: [\n\t\t\t{value: \"plus\", display: \"+\"},\n\t\t\t{value: \"minus\", display: \"-\"}\n\t\t]\n\t}\n\n\t//return invalid params\n\tfunction validateQuantityProperties(data) {\n\t\tconst fixedValue = data.comparator.indexOf(\"populated\") === -1 &&\n\t\t\tdata.compareTo === \"fixed\" &&\n\t\t\t!/^\\d+\\.?\\d+$/.test(data.fixedValue);\n\t\tconst unitCode = data.unitCode && data.unitCode.trim().indexOf(\" \") > -1;\n\t\tconst unitSystem = data.unitSystem && data.unitSystem.trim().indexOf(\" \") > -1\n\t\treturn (fixedValue || unitCode || unitSystem) && \n\t\t\t{fixedValue, unitCode, unitSystem};\n\t}\n\n\tconst handleChange = (field, value) => {\n\t\tconst newData = {...props.data, [field]: value};\n\t\tconst invalid = validateQuantityProperties(newData);\n\t\tprops.onUpdate({...newData, invalid});\n\t}\n\n\tconst mapOptions = (property) => {\n\t\treturn options[property].map( o => {\n\t\t\treturn <option value={o.value} key={o.value}>{o.display}</option>\n\t\t});\n\t};\n\n\tconst renderHeader = () => <div className=\"my-2\">\n\t\t<span className=\"mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t<span>is</span>\n\t\t{!props.hideControls && <FontAwesomeIcon \n\t\t\ticon={faTrashAlt} opacity=\"0.5\"\n\t\t\tonClick={e => props.onDelete(props.id)} \n\t\t\tstyle={{cursor: \"pointer\"}} \n\t\t\tpull=\"right\" \n\t\t/>}\n\t</div>\n\n\tconst renderComparator = () => <div className=\"my-2\">\n\t\t<select className=\"form-control\"\n\t\t\tvalue={props.data.comparator || \"gt\"} \n\t\t\tonChange={e => handleChange(\"comparator\", e.target.value)}\n\t\t>{mapOptions(\"comparator\")}</select>\n\t</div>\n\n\tconst renderCompareTarget = () => {\n\t\tconst invalidValue = props.data.validate && props.data.invalid && props.data.invalid.fixedValue;\n\t\tconst invalidUnitSystem = props.data.validate && props.data.invalid && props.data.invalid.unitSystem;\n\t\tconst invalidUnitCode = props.data.validate && props.data.invalid && props.data.invalid.unitCode;\n\n\t\treturn <>\n\t\t\t\t<div className=\"my-2 form-row\">\n\t\t\t\t<Col>\n\t\t\t\t\t<select className=\"form-control\"\n\t\t\t\t\t\tvalue={props.data.compareTo || \"fixed\"} \n\t\t\t\t\t\tonChange={e => handleChange(\"compareTo\", e.target.value)}\n\t\t\t\t\t>{mapOptions(\"compareTarget\")}\n\t\t\t\t\t\t{(props.relativeOptions || []).sort().map( r => {\n\t\t\t\t\t\t\treturn <option key={r.value} value={r.value}>{r.label}</option>\n\t\t\t\t\t\t})}\n\t\t\t\t\t</select>\n\t\t\t\t</Col>\n\t\t\t\t{(!props.data.compareTo || props.data.compareTo === \"fixed\") && <Col>\n\t\t\t\t\t<input type=\"number\" className=\"form-control\"\n\t\t\t\t\t\trequired={true} \n\t\t\t\t\t\tvalue={props.data.fixedValue || \"\"} \n\t\t\t\t\t\tonChange={e => handleChange(\"fixedValue\", e.target.value)}\n\t\t\t\t\t\tclassName={invalidValue ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t\t/>\n\t\t\t\t</Col>}\n\t\t\t</div>\n\t\t\t{(props.data.compareTo === \"fixed\") && <div className=\"form-row my-2\">\n\t\t\t\t<Col xs=\"4\">\n\t\t\t\t\t<input className=\"form-control\"\n\t\t\t\t\t\trequired={false} \n\t\t\t\t\t\tvalue={props.data.unitCode || \"\"} \n\t\t\t\t\t\tplaceholder=\"Unit Code\"\n\t\t\t\t\t\tonChange={e => handleChange(\"unitCode\", e.target.value)}\n\t\t\t\t\t\tclassName={invalidUnitCode ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t\t/>\n\t\t\t\t</Col><Col>\n\t\t\t\t\t<input className=\"form-control\"\n\t\t\t\t\t\trequired={false} \n\t\t\t\t\t\tvalue={props.data.unitSystem || \"\"} \n\t\t\t\t\t\tplaceholder=\"Unit System\"\n\t\t\t\t\t\tonChange={e => handleChange(\"unitSystem\", e.target.value)}\n\t\t\t\t\t\tclassName={invalidUnitSystem ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t\t/>\n\t\t\t</Col>\n\t\t\t</div>}\n\t\t</>\n\t}\n\n\tconst renderCompareOffset = () => <div className=\"my-2 form-row\"><Col>\n\t\t<select className=\"form-control\"\n\t\t\tvalue={props.data.offsetDir || \"plus\"} \n\t\t\tonChange={e => handleChange(\"offsetDir\", e.target.value)}\n\t\t>{mapOptions(\"offsetDir\")}</select>\n\t</Col><Col>\n\t\t<input type=\"number\" className=\"form-control\"\n\t\t\tvalue={props.data.offsetValue || \"\"}  required={true}\n\t\t\tonChange={e => handleChange(\"offsetValue\", e.target.value)}\n\t\t/>\n\t</Col></div>\n\n\tconst simpleComparator = props.data.comparator &&\n\t\tprops.data.comparator.indexOf(\"populated\") !== -1;\n\n\tconst renderDisplay = () => {\n\n\t\tconst renderOffset = () => {\n\t\t\tif (!props.data.offsetValue) return;\n\t\t\treturn <span className=\"mr-1 mt-1 mark\">\n\t\t\t\t{findOption(\"offsetDir\", props.data.offsetDir)}\n\t\t\t\t{\" \"}{props.data.offsetValue}\n\t\t\t</span>\n\t\t};\n\n\t\tconst findOption = (property, value) => {\n\t\t\treturn options[property].find( o => o.value === value).display;\n\t\t}\n\n\t\tconst compareToLabel = !simpleComparator && props.data.compareTo.indexOf(\".\") > -1 &&\n\t\t\tprops.relativeOptions.find( r => r.value === props.data.compareTo ).label;\n\n\n\t\treturn <div>\n\t\t\t{!props.hideControls && \n\t\t\t\t<FontAwesomeIcon icon={faEdit} opacity=\"0.5\" style={{cursor: \"pointer\"}} pull=\"right\" className=\"m-1\" />\n\t\t\t}\n\t\t\t\n\t\t\t<div style={{lineHeight: 2}}>\n\t\t\t\t<span className=\"mt-1 mr-1 font-weight-bold\">{props.fieldDefinition.name}</span>\n\t\t\t\t<span className=\"mt-1 mr-1\">is</span>\n\t\t\t\t<span className=\"mt-1 mr-1 mark\">\n\t\t\t\t\t{findOption(\"comparator\", props.data.comparator).toLowerCase()}\n\t\t\t\t</span>\n\n\t\t\t\t{!simpleComparator && props.data.compareTo === \"fixed\" && <>\n\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">{props.data.fixedValue}</span>\n\t\t\t\t\t{props.data.unitCode && <span className=\"mt-1 mr-1 mark\">{props.data.unitCode}</span>}\n\t\t\t\t</>}\n\n\t\t\t\t{!simpleComparator && props.data.compareTo.indexOf(\".\") > -1 && <>\n\t\t\t\t\t<span className=\"d-inline-block\">\n\t\t\t\t\t\t<span className=\"mt-1 mr-1 mark\">{compareToLabel}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t{renderOffset()}\n\t\t\t\t</>}\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\tconst renderEdit = () => <>\n\t\t{ renderHeader() }\n\t\t{ renderComparator() }\n\t\t{ !simpleComparator && renderCompareTarget() }\n\t\t{ !simpleComparator && props.data.compareTo !== \"fixed\" && renderCompareOffset() }\n\t</>\n\n\treturn props.edit ? renderEdit() : renderDisplay();\n\t\n}\n\nfunction defaultQuantityProperties() {\n\treturn {\n\t\tcomparator: \"gte\", compareTo: \"fixed\",\n\t\tfixedValue: \"\",\n\t\toffsetDir: \"plus\", offsetValue: 0, \n\t\tinvalid: false\n\t}\n}\n\nexport default QuantityRule;\nexport {defaultQuantityProperties};","import React, {useState} from \"react\";\nimport DateRule, {defaultDateProperties} from \"./DateRule\";\nimport CodingRule, { defaultCodingProperties } from \"./CodingRule\";\nimport CompositeRule from \"./CompositeRule\";\nimport {Button, ListGroup, ListGroupItem }  from \"react-bootstrap\";\nimport IdRule from \"./IdRule\";\nimport QuantityRule, { defaultQuantityProperties } from \"./QuantityRule\";\n\nfunction RuleSet(props) {\n\n\tconst [edit, setEdit] = useState(props.edit);\n\n\tconst handleUpdateRule = (pos, ruleData) => {\n\t\tprops.onUpdate(\n\t\t\tprops.data.map( (r, i) => pos === i ? ruleData : r )\n\t\t)\n\t}\n\n\tconst handleDeleteRule = pos => {\n\t\tif (props.data.length === 1)\n\t\t\treturn props.onDelete(props.id);\n\n\t\tprops.onUpdate(\n\t\t\tprops.data.filter( (r, i) => pos !== i )\n\t\t)\n\t}\n\n\tconst handleOr = () => {\n\t\tprops.onUpdate(\n\t\t\tprops.data.concat([getRuleDefaults(props.fieldDefinition)])\n\t\t);\n\t}\n\n\tconst handleDone = () => {\n\t\tconst invalid = props.data.filter( r => r.invalid ? true : false )\n\t\tif (invalid.length)\n\t\t\treturn props.onUpdate(\n\t\t\t\tprops.data.map( r => ({...r, validate: true}) )\n\t\t\t);\n\n\t\tsetEdit(false);\n\t}\n\t\t\n\tconst renderRule = (ruleData, i) => {\n\t\tif (props.fieldDefinition.type === \"instant\") {\n\t\t\tconst relativeOptions = (props.relativeOptions||[]).filter( r => r.fieldType === \"instant\" );\n\t\t\treturn <DateRule \n\t\t\t\tdata={ruleData} \n\t\t\t\tfieldDefinition={props.fieldDefinition} \n\t\t\t\trelativeOptions={relativeOptions}\n\t\t\t\tedit={edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\tonDelete={e => handleDeleteRule(i)}\n\t\t\t\thideControls={!edit && i > 0}\n\t\t\t/>\n\t\t} else if (props.fieldDefinition.type === \"coding\") {\n\t\t\treturn <CodingRule \n\t\t\t\tdata={ruleData} \n\t\t\t\tfieldDefinition={props.fieldDefinition} \n\t\t\t\tedit={edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\tonDelete={e => handleDeleteRule(i)}\n\t\t\t\thideControls={!edit && i > 0}\n\t\t\t/>\n\t\t} else if (props.fieldDefinition.type === \"composite\") {\n\t\t\treturn <CompositeRule\n\t\t\t\tdata={ruleData} \n\t\t\t\tfieldDefinition={props.fieldDefinition} \n\t\t\t\tedit={edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\tonDelete={e => handleDeleteRule(i)}\n\t\t\t\thideControls={!edit && i > 0}\n\t\t\t/>\n\t\t} else if (props.fieldDefinition.type === \"fhirId\") {\n\t\t\tconst relativeOptions = (props.relativeOptions||[]).filter( r => r.fieldType === \"fhirId\" );\n\t\t\treturn <IdRule \n\t\t\t\tdata={ruleData} \n\t\t\t\trelativeOptions={relativeOptions}\n\t\t\t\tfieldDefinition={props.fieldDefinition} \n\t\t\t\tedit={edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\tonDelete={e => handleDeleteRule(i)}\n\t\t\t\thideControls={!edit && i > 0}\n\t\t\t/>\n\t\t} else if (props.fieldDefinition.type === \"quantity\") {\n\t\t\tconst relativeOptions = (props.relativeOptions||[]).filter( r => r.fieldType === \"quantity\" );\n\t\t\treturn <QuantityRule \n\t\t\t\tdata={ruleData} \n\t\t\t\trelativeOptions={relativeOptions}\n\t\t\t\tfieldDefinition={props.fieldDefinition} \n\t\t\t\tedit={edit}\n\t\t\t\tonUpdate={data => handleUpdateRule(i, data)}\n\t\t\t\tonDelete={e => handleDeleteRule(i)}\n\t\t\t\thideControls={!edit && i > 0}\n\t\t\t/>\n\t\t}\n\t}\n\n\treturn <ListGroup className=\"shadow my-4\">\n\t\t{edit && <ListGroupItem className=\"text-right\">\n\t\t\t<Button variant=\"outline-primary\" size=\"sm\"\n\t\t\t\tonClick={handleDone} \n\t\t\t>Done</Button>\n\t\t</ListGroupItem>}\n\n\t\t{props.data.map( (rule, i) => {\n\t\t\treturn <ListGroupItem key={i}  onClick={e => !edit && setEdit(true)}>\n\t\t\t\t{i > 0 && <div className=\"text-center p-1 mb-1\">\n\t\t\t\t\t<span className=\"badge badge-pill badge-primary\">or</span>\n\t\t\t\t</div>}\n\t\t\t\t{ renderRule(rule, i) }\n\t\t\t</ListGroupItem>\n\t\t})}\n\n\t\t{edit && <ListGroupItem className=\"text-center\">\n\t\t\t<Button variant=\"outline-primary\" size=\"sm\"\n\t\t\t\tonClick={handleOr}\n\t\t\t>Or...</Button>\n\t\t</ListGroupItem>}\n\t</ListGroup>\n\n}\n\n\nfunction getRuleDefaults(fieldDefinition, ruleData={}) {\n\tif (fieldDefinition.type === \"composite\") {\n\t\tconst children = fieldDefinition.fields.map( (field, i) => {\n\t\t\treturn getRuleDefaults(field, (ruleData && ruleData[i]) || {});\n\t\t});\n\t\treturn {children};\n\t} else if (fieldDefinition.type === \"instant\") {\n\t\treturn  {invalid: false, ...defaultDateProperties(), ...(fieldDefinition.defaults || {}), ...ruleData};\n\t} else if (fieldDefinition.type === \"quantity\") {\n\t\treturn  {invalid: false, ...defaultQuantityProperties(), ...(fieldDefinition.defaults || {}), ...ruleData};\n\t} else if (fieldDefinition.type === \"coding\") {\n\t\treturn  {invalid: true, ...defaultCodingProperties(), ...(fieldDefinition.defaults || {}), ...ruleData};\n\t} else {\n\t\treturn  {invalid: true, ...(fieldDefinition.defaults || {}), ...ruleData};\n\t}\n}\n\n\nexport default RuleSet;\nexport {getRuleDefaults} ;","import React from \"react\";\nimport _ from \"lodash\";\n\nfunction Retention(props) {\n\n\tconst retentionValue = props.retentionType !== \"none\" && \n\t\tprops.retentionType !== \"all\" && props.retentionSortField\n\t\t\t? props.retentionType + \".\" + props.retentionSortField \n\t\t\t: props.retentionType || \"none\";\n\n\tconst retentionOptions = [\n\t\t{name: `Don't retain matching ${props.definition.name} values` , value: \"none\"},\n\t\t{name: `Retain all matching ${props.definition.name} values`, value: \"all\"}\n\t].concat(\n\t\t_.chain(props.definition.fields)\n\t\t\t.filter( f => f.type === \"instant\" )\n\t\t\t.sortBy( \"name\" )\n\t\t\t.map( f => [\n\t\t\t\t{name: \"Retain most recent match based on \" + f.name , value: \"latest.\"+f.name},\n\t\t\t\t{name: \"Retain earliest match based on \" + f.name , value: \"earliest.\"+f.name}\n\t\t\t]).flatten().value()\n\t);\n\n\tconst handleVarChange = e => {\n\t\tif (/^[a-zA-Z_]?[a-zA-Z0-9_]*$/.test(e.target.value)) {\n\t\t\tconst invalid = !e.target.value || \n\t\t\t\t(props.usedVars||[]).find( v => v === e.target.value );\n\t\t\tprops.onChange({retentionVar: e.target.value, invalid});\n\t\t}\n\t}\n\n\tconst handleValueChange = e => {\n\t\tconst [retentionType, retentionSortField] = e.target.value.split(\".\");\n\t\tconst invalid = retentionType !== \"none\" && (!props.retentionVar || props.invalid);\n\t\tprops.onChange({retentionType, retentionSortField, invalid});\n\t}\n\n\tconst renderEdit = () => {\n\t\tconst errors = props.validate && props.invalid;\n\t\tconst retentionVar = props.retentionVar || \"\";\n\t\n\t\treturn <div className=\"container-fluid\">\n\t\t\t<div className=\"row my-1\"><div className=\"col\">\n\t\t\t\t<select className=\"form-control\"\n\t\t\t\t\tvalue={retentionValue} \n\t\t\t\t\tonChange={handleValueChange}\n\t\t\t\t>{\n\t\t\t\t\tretentionOptions.map( r => {\n\t\t\t\t\t\treturn <option key={r.value} value={r.value}>{r.name}</option>\n\t\t\t\t\t})\n\t\t\t\t}</select>\n\t\t\t</div></div>\n\t\n\t\t\t{retentionValue !== \"none\" && <div className=\"form-row my-2\">\n\t\t\t\t<div className=\"col col-auto align-self-center\">as</div>\n\t\t\t\t<div className=\"col\">\n\t\t\t\t\t<input value={retentionVar} \n\t\t\t\t\t\tplaceholder=\"Name\"\n\t\t\t\t\t\tonChange={handleVarChange} \n\t\t\t\t\t\tclassName={errors ? \"is-invalid form-control\" : \"form-control\"}\n\t\t\t\t\t/>\n\t\t\t\t\t{ errors &&\n\t\t\t\t\t\t<div className=\"small text-danger mt-1\">Note: variable name can't be blank and must be unique</div>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</div>}\n\t\n\t\t</div>\n\t}\n\n\treturn renderEdit() ;\n\n\n}\n\nexport default Retention;","import React, {useState} from \"react\";\nimport RuleSet, {getRuleDefaults} from \"./RuleSet\";\nimport Retention from \"./Retention\";\nimport _ from \"lodash\";\nimport { Modal, Button, DropdownButton, Dropdown, ListGroup, ListGroupItem, Form }  from \"react-bootstrap\";\n\nfunction BlockEditor(props) {\n\n\tconst [name, setName] = useState(props.data.name);\n\tconst [retention, setRetention] = useState(props.data.retention || {retentionType: \"none\"});\n\tconst [rules, setRules] = useState(props.data.rules || []);\n\tconst [nextRuleId, setNextRuleId] = useState(props.data.nextRuleId || 0);\n\n\tconst [isDirty, setIsDirty] = useState();\n\tconst [dirtyWarning, setDirtyWarning] = useState();\n\n\tconst [definition, setDefinition] = useState(props.data.definition);\n\tconst [validate, setValidate] = useState();\n\t\n\tconst updateRule = (ruleId, newRule) => {\n\t\tsetRules(\n\t\t\trules.map(rule => rule.id !== ruleId ? rule : {...rule, ruleSet: newRule})\n\t\t);\n\t\tsetIsDirty(true);\n\t}\n\n\tconst addRule = fieldName => {\t\n\t\tconst fieldDefinition = definition.fields.find( d => d.name === fieldName);\n\t\tsetRules(\n\t\t\trules.concat([{id: nextRuleId, fieldName, edit: true, ruleSet: [getRuleDefaults(fieldDefinition)] }])\n\t\t);\n\t\tsetNextRuleId(nextRuleId+1);\n\t\tsetIsDirty(true);\n\t}\n\n\tconst deleteRule = ruleId => {\n\t\tsetRules(rules.filter( rule => rule.id !== ruleId ));\n\t\tsetIsDirty(true)\n\t}\n\n\tconst handleSaveBlock = () => {\n\t\tconst invalidRules = rules.filter(r => {\n\t\t\treturn r.ruleSet.filter(rs => rs.invalid ? true : false).length\n\t\t});\n\t\tif (invalidRules.length > 0) setRules(\n\t\t\trules.map( r => ({\n\t\t\t\t...r,\n\t\t\t\tedit: r.ruleSet.filter(rs => rs.invalid ? true : false).length > 0,\n\t\t\t\truleSet: r.ruleSet.map(rs => ({...rs, validate: true}) )\n\t\t\t}) )\n\t\t);\n\t\tif (retention.invalid || !name) setValidate(true);\n\t\tif (invalidRules.length > 0 || retention.invalid || !name)\n\t\t\treturn;\n\t\t\n\t\tprops.onSave({\n\t\t\tname, retention, definition, \n\t\t\tparentId: props.parentId, id: props.id,\n\t\t\tnextRuleId,\n\t\t\trules: rules.map( r => ({\n\t\t\t\t...r,\n\t\t\t\tedit: false,\n\t\t\t\truleSet: r.ruleSet.map(rs => ({...rs, validate: false}) )\n\t\t\t}) )\n\t\t})\n\t\n\t}\n\n\tconst handleClose = (e, force) => {\n\t\te && e.preventDefault();\n\t\tif (isDirty && !force && definition) {\n\t\t\tsetDirtyWarning(true);\n\t\t} else {\n\t\t\tprops.onClose();\n\t\t}\n\t}\n\n\tconst renderRenderBlockTypeList = () => {\n\t\tconst renderBlockType = (block, i) => {\n\t\t\treturn <ListGroupItem key={i} action onClick={ e => {\n\t\t\t\tsetName(block.name); \n\t\t\t\tsetDefinition(block);\n\t\t\t }}>\n\t\t\t\t{block.name}\n\t\t\t</ListGroupItem>\n\t\t}\n\t\treturn <>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title>Block Type</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><ListGroup>\n\t\t\t\t{props.definitions.map(renderBlockType)}\n\t\t\t</ListGroup></Modal.Body>\n\t\t</>\n\t}\n\n\tconst renderHeader = () => {\n\t\tconst idJoinOptions = props.relativeOptions.find( r => r.fieldType === \"fhirId\");\n\t\tconst ddFields = definition.fields\n\t\t\t.filter( f => f.name !== \"patient\" && (idJoinOptions || f.type !== \"fhirId\"));\n\n\t\treturn <div className=\"d-flex\">\n\t\t\t<DropdownButton title=\"Add Rule\" variant=\"success\" className=\"mr-auto\">\n\t\t\t\t{ddFields.map( field => {\n\t\t\t\t\treturn <Dropdown.Item onClick={e => addRule(field.name)} key={field.name}>\n\t\t\t\t\t\t{field.name}\n\t\t\t\t\t</Dropdown.Item>\n\t\t\t\t})}\n\t\t\t</DropdownButton>\n\t\t\t<Button variant=\"outline-danger\" className=\"mr-2\" onClick={props.onDelete}>Delete Block</Button>\n\t\t\t{ isDirty && <Button variant=\"primary\" className=\"mr-1\" onClick={handleSaveBlock}>Save Block</Button> }\n\t\t</div>\n\t}\n\n\n\tconst renderRules = () => {\n\t\treturn rules.map( rule => {\n\t\t\tconst id = rule.id;\n\t\t\tconst fieldDefinition = definition.fields.find( d => d.name === rule.fieldName)\n\t\t\treturn <div key={rule.id}><RuleSet\n\t\t\t\tfieldDefinition={fieldDefinition}\n\t\t\t\trelativeOptions={props.relativeOptions}\n\t\t\t\tdata={rule.ruleSet}\n\t\t\t\tedit={rule.edit}\n\t\t\t\tonUpdate={r => updateRule(id, r)}\n\t\t\t\tonDelete={r => deleteRule(id, r)}\n\t\t\t/></div>\n\t\t})\n\t}\n\n\tconst hasErrors = rules.filter(r => {\n\t\treturn r.ruleSet.filter(rs => rs.invalid && rs.validate ? true : false).length > 0\n\t}).length > 0 || (validate && !name) || (validate && retention.invalid);\n\n\tconst renderRuleList = () => <>\n\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title className=\"d-flex flex-grow-1\">\n\t\t\t\t<Form.Control \n\t\t\t\t\tautoFocus\n\t\t\t\t\tplaceholder=\"Name\"\n\t\t\t\t\tvalue={name || \"\"}\n\t\t\t\t\tclassName={validate && !name ? \"is-invalid\" : \"\"}\n\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\tsetName(e.target.value);\n\t\t\t\t\t\tsetIsDirty(true);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t</Modal.Title>\n\t\t</Modal.Header>\n\t\t<Modal.Body>\n\t\t\t<p>Block Type: {definition.name}</p>\n\t\t\t{ dirtyWarning && <div className=\"alert alert-danger text-center mb-4\">\n\t\t\t\tYou have unsaved changes -&nbsp;\n\t\t\t\t<a href=\"#\" className=\"alert-link\" onClick={e => handleClose(e, true)}>discard?</a>\n\t\t\t</div>}\n\t\t\t{ hasErrors && <div className=\"alert alert-danger text-center mb-4\">\n\t\t\t\tPlease fix the highlighted errors\n\t\t\t</div>}\n\t\t\t{ renderHeader() }\n\t\t\t{ renderRules() }\n\t\t</Modal.Body>\n\t\t<Modal.Footer>\n\t\t\t<Retention\n\t\t\t\t{...retention}\n\t\t\t\tdefinition={definition}\n\t\t\t\tusedVars={props.usedVars}\n\t\t\t\tvalidate={validate}\n\t\t\t\tonChange={newRetention => {\n\t\t\t\t\tsetRetention({...retention, ...newRetention}); \n\t\t\t\t\tsetIsDirty(true)\n\t\t\t\t}}\n\t\t\t\tedit={true}\n\t\t\t/>\n\t\t</Modal.Footer>\n\t</>\n\n\treturn <Modal backdrop=\"static\" show={true} animation={false} onHide={handleClose} size=\"lg\">\n\t\t{definition ? renderRuleList() : renderRenderBlockTypeList()}\n\t</Modal>\n\n}\n\nexport default BlockEditor;","import React, {useState} from \"react\";\nimport _ from \"lodash\";\nimport { Button, DropdownButton, Dropdown } from \"react-bootstrap\";\nimport { useStoreon } from \"storeon/react\";\nimport BlockEditor from \"./BlockEditor\";\n\nfunction BlockChart(props) {\n\n\tconst { dispatch, blocks, definitions } = useStoreon(\"blocks\", \"definitions\");\n\tconst [activeInstance, setActiveInstance] = useState();\n\t// const [activeInstance, setActiveInstance] = useState({id: 2, parentId: 0});\n\tlet cells = {};\n\n\tconst blockList = blocks.concat(\n\t\tblocks.filter( b => {\n\t\t\treturn !blocks.find( node => node.parentId === b.id )\n\t\t}).map( b => {\n\t\t\treturn {id: b.id+\"-end\", name: b.exclude? \"Exclude\" : \"Include\", parentId: b.id, isLeaf:true}\n\t\t})\n\t)\n\n\tconst walkUp = (id, span=1) => {\n\t\tconst node = blockList.find( b => b.id === id );\n\t\tif (cells[id]) {\n\t\t\tcells[id].span = cells[id].span + span;\n\t\t} else {\n\t\t\tcells[id] = {id, span, name: node.name, retention: node.retention, parentId: node.parentId, isLeaf: node.isLeaf}\n\t\t}\n\t\tif (node && node.parentId !== null) walkUp(node.parentId, span)\n\n\t}\n\n\tconst walkDown = (id, row, col=1) => {\n\t\tcells[id] = {...cells[id], id, row, col,}\n\n\t\tlet nextCol = col;\n\t\tblockList.filter( bi => bi.parentId === id )\n\t\t\t.forEach( child => {\n\t\t\t\twalkDown(child.id, row+1, nextCol)\n\t\t\t\tnextCol = nextCol + cells[child.id].span;\n\t\t\t});\n\t}\n\n\t//walk up from leaf nodes\n\tblockList.filter( bi => {\n\t\treturn !blockList.find( child => child.parentId === bi.id )\n\t}).forEach( node => walkUp(node.id) );\n\n\t//walk down from root node\n\tblockList.filter( bi => bi.parentId === null )\n\t\t.forEach( (node, i) => walkDown(node.id, 1, 1) );\n\n\tconst colCount = blockList.reduce( (acc, node) => {\n\t\tconst cell = cells[node.id];\n\t\treturn Math.max(acc, cell.col + cell.span);\n\t}, 0);\n\n\tconst rowCount = blockList.reduce( (acc, node) => {\n\t\treturn Math.max(acc, cells[node.id].row) \n\t}, 0);\n\n\tconst saveBlock = data => {\n\t\tdispatch(\"block/upsert\", {block: data, insertAbove: (activeInstance && activeInstance.insertAbove) || undefined});\n\t\tsetActiveInstance(null);\n\t}\n\n\tconst deleteBlock = () => {\n\t\tif (activeInstance.id !== undefined)\n\t\t\tdispatch(\"block/delete\", activeInstance);\n\t\tsetActiveInstance(null);\n\t}\n\n\tlet skip = 0;\n\tconst renderCell = (r, c, cell) => {\n\n\t\tconst cellStyles = \"btn m-2 p-4 flex-grow-1 block-button text-dark \" + (\n\t\t\t(cell.name === \"Include\" && \"btn-outline-success\") || \n\t\t\t(cell.name === \"Exclude\" && \"btn-outline-danger\") ||\n\t\t\t\"btn-outline-primary\"\n\t\t);\n\n\t\tconst retentionText = cell.retention && cell.retention.retentionType !== \"none\"\n\t\t\t? `retain ${cell.retention.retentionType} as ${cell.retention.retentionVar}`\n\t\t\t: \"\";\n\n\t\tconst name = retentionText\n\t\t\t? <span>{cell.name}<br/>&#8595;<br/>{retentionText}</span>\n\t\t\t: cell.name;\n\n\t\treturn <td key={r+\":\"+c} colSpan={cell.span} className=\"text-center\" style={{height: \"1px\"}}>\n\t\t\t<div className=\"h-100 w-100 d-flex flex-column\">\n\t\t\t\t{ r !== 1 && !cell.isLeaf && <div>\n\t\t\t\t\t<DropdownButton title=\"&#8595;\" size=\"sm\" variant=\"outline-primary\" className=\"m-2 no-caret\">\n\t\t\t\t\t\t<Dropdown.Item href=\"#\" onClick={e => setActiveInstance({parentId: cell.parentId})}>Add Branch</Dropdown.Item>\n\t\t\t\t\t\t<Dropdown.Item href=\"#\" onClick={e => setActiveInstance({parentId: cell.parentId, insertAbove: cell.id})}>Insert Block</Dropdown.Item>\n\t\t\t\t\t</DropdownButton>\n\t\t\t\t</div> }\n\n\t\t\t\t{ cell.isLeaf && <div>\n\t\t\t\t\t<Button size=\"sm\" variant=\"outline-primary\" className=\"m-2\"\n\t\t\t\t\t\tonClick={e => setActiveInstance({parentId: cell.parentId})}\n\t\t\t\t\t>&#8595;</Button>\n\t\t\t\t</div> }\n\n\t\t\t\t<button className={cellStyles} onClick={e => {\n\t\t\t\t\tif (cell.isLeaf) {\n\t\t\t\t\t\tsaveBlock({\n\t\t\t\t\t\t\tid: cell.parentId, \n\t\t\t\t\t\t\texclude: cell.name === \"Exclude\" ? false : true\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (cell.id !==\"root\" && !cell.isLeaf) {\n\t\t\t\t\t\tsetActiveInstance({id: cell.id, parentId: cell.parentId})\n\t\t\t\t\t};\n\t\t\t\t}}>{name}</button>\n\t\t\t\t\n\t\t\t</div>\n\t\t</td>;\n\t}\n\n\tconst renderRow = r => {\n\t\tlet skip = 0;\n\t\treturn <tr key={r} className=\"\" style={{height: \"100%\"}}>{\n\t\t\t _.range(1, colCount).map( c => {\n\t\t\t\t if (skip) {\n\t\t\t\t\tskip -=1;\n\t\t\t\t\treturn;\n\t\t\t\t }\n\t\t\t\tconst cell = _.find(cells, cell => cell.row === r && cell.col === c);\n\t\t\t\tif (cell) {\n\t\t\t\t\tskip = cell.span-1;\n\t\t\t\t\treturn renderCell(r, c, cell) \n\t\t\t\t} else {\n\t\t\t\t\treturn <td key={r+\":\"+c}></td>;\n\t\t\t\t}\n\t\t\t})\n\t\t}</tr>\n\t}\n\t\n\tconst getRelativeOptions = (blockId, blocks) => {\n\t\tlet relativeOptions = [];\n\n\t\tconst block = blocks.find( b => b.id === blockId);\n\n\t\tblock.retention && block.retention.retentionVar && \n\t\t\tblock.definition.fields.forEach( field => {\n\t\t\t\tif (field.type === \"composite\") {\n\t\t\t\t\tblock.rules.forEach( rule => {\n\t\t\t\t\t\trule.ruleSet.forEach( rs => {\n\t\t\t\t\t\t\tif (!rs.name) return;\n\t\t\t\t\t\t\tfield.fields.forEach( childField => {\n\t\t\t\t\t\t\t\trelativeOptions.push({\n\t\t\t\t\t\t\t\t\tretentionVar: block.retention.retentionVar,\n\t\t\t\t\t\t\t\t\tcompositeName: rs.name,\n\t\t\t\t\t\t\t\t\tfieldType: childField.type,\n\t\t\t\t\t\t\t\t\tfieldName: childField.name,\n\t\t\t\t\t\t\t\t\tvalue: [block.id, rs.name, childField.name].join(\".\"),\n\t\t\t\t\t\t\t\t\tlabel: [block.retention.retentionVar, rs.name, childField.name].join(\".\")\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (field.type !== \"composite\") {\n\t\t\t\t\trelativeOptions.push({\n\t\t\t\t\t\tretentionVar: block.retention.retentionVar,\n\t\t\t\t\t\tfieldType: field.type,\n\t\t\t\t\t\tfieldName: field.name,\n\t\t\t\t\t\tvalue: [block.id, field.name].join(\".\"),\n\t\t\t\t\t\tlabel: [block.retention.retentionVar, field.name].join(\".\")\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\treturn block.parentId !== null\n\t\t\t? relativeOptions.concat( getRelativeOptions(block.parentId, blocks) )\n\t\t\t: relativeOptions;\n\t}\n\n\n\n\tconst renderModal = () => {\n\t\tconst data = blocks.find( b => b.id === activeInstance.id) || {};\n\t\tconst retentionVar = data.retention && data.retention.retentionType !== \"none\" ? data.retention.retentionVar : \"\";\n\t\tconst usedVars = blocks\n\t\t\t.filter( b => b.retention && b.retention.retentionType !== \"none\" && \n\t\t\t\tb.retention.retentionVar && \n\t\t\t\tb.retention.retentionVar !== retentionVar\n\t\t\t)\n\t\t\t.map( b => b.retention.retentionVar );\n\n\t\tconst relativeOptions = data.parentId !== null ? getRelativeOptions(activeInstance.parentId, blocks) : [];\n\n\t\treturn <BlockEditor \n\t\t\tid={activeInstance.id}\n\t\t\tparentId={activeInstance.parentId}\n\t\t\tdata={data}\n\t\t\tdefinitions={definitions}\n\t\t\tusedVars={usedVars}\n\t\t\tonClose={e => setActiveInstance(null)}\n\t\t\trelativeOptions={relativeOptions}\n\t\t\tonSave={saveBlock}\n\t\t\tonDelete={deleteBlock}\n\t\t/>\n\t}\n\n\treturn <div>\n\t\t<div className=\"container-fluid split\"><table className=\"m-4\"><tbody>\n\t\t\t{ _.range(1, rowCount+1).map( renderRow )}\n\t\t</tbody></table></div>\n\t\t{ activeInstance && renderModal() }\n\t</div>\n\t\n\n}\n\nexport default BlockChart;","import React from 'react';\nimport './App.css';\nimport BlockChart from \"./BlockChart\";\n\nfunction App() {\n\n\treturn <BlockChart />\n}\n\nexport default App;\n","export default [{\n\t\"name\": \"Lab Result - Numerical\",\n\t\"version\": \"1.0.0.alpha\",\n\t\"fields\": [\n\t\t{\"name\": \"patient\", \"type\": \"fhirId\", \"field\": \"ptId\", \"exprSuffix\": \"subject.type = 'Patient'\"},\n\t\t{\"name\": \"id\", \"type\": \"fhirId\", \"field\": \"rId\"},\n\t\t{\"name\": \"status\", \"type\": \"coding\", \"field\": \"status\", \"editable\": false,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"registered\"}], \"name\": \"Registered\"},\n\t\t\t\t{\"values\": [{\"code\": \"preliminary\"}], \"name\": \"Preliminary\"},\n\t\t\t\t{\"values\": [{\"code\": \"final\"}], \"name\": \"Final\"},\n\t\t\t\t{\"values\": [{\"code\": \"amended\"}], \"name\": \"Amended\"},\n\t\t\t\t{\"values\": [{\"code\": \"corrected\"}], \"name\": \"- Corrected\"},\n\t\t\t\t{\"values\": [{\"code\": \"cancelled\"}], \"name\": \"Cancelled\"},\n\t\t\t\t{\"values\": [{\"code\": \"entered-in-error\"}], \"name\": \"Entered in Error\"},\n\t\t\t\t{\"values\": [{\"code\": \"unknown\"}], \"name\": \"Unknown\"}\n\t\t\t]\n\t\t},\n\t\t{\"name\": \"effectiveDateTimeStart\", \"type\": \"instant\", \"field\": \"effectiveDateTimeStart\"},\n\t\t{\"name\": \"effectiveDateTimeEnd\", \"type\": \"instant\", \"field\": \"effectiveDateTimeEnd\"},\n\t\t{\"name\": \"valueQuantity\", \"type\": \"quantity\", \"field\": \"valueQuantity\"},\n\t\t{\"name\": \"code\", \"type\": \"coding\", \"field\": \"code\"},\n\t\t{\"name\": \"dataAbsentReason\", \"type\": \"coding\", \"field\": \"dataAbsentReason\", \"editable\": true,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"unknown\"}], \"name\": \"Unknown\"},\n\t\t\t\t{\"values\": [{\"code\": \"asked-unknown\"}], \"name\": \"-  Asked But Unknown\"},\n\t\t\t\t{\"values\": [{\"code\": \"temp-unknown\"}], \"name\": \"-  Temporarily Unknown\"},\n\t\t\t\t{\"values\": [{\"code\": \"not-asked\"}], \"name\": \"  Not Asked\"},\n\t\t\t\t{\"values\": [{\"code\": \"asked-declined\"}], \"name\": \"-  Asked But Declined\"},\n\t\t\t\t{\"values\": [{\"code\": \"masked\"}], \"name\": \"Masked\"},\n\t\t\t\t{\"values\": [{\"code\": \"not-applicable\"}], \"name\": \"Not Applicable\"},\n\t\t\t\t{\"values\": [{\"code\": \"unsupported\"}], \"name\": \"Unsupported\"},\n\t\t\t\t{\"values\": [{\"code\": \"as-text\"}], \"name\": \"As Text\"},\n\t\t\t\t{\"values\": [{\"code\": \"error\"}], \"name\": \"Error\"},\n\t\t\t\t{\"values\": [{\"code\": \"not-a-number\"}], \"name\": \"-  Not a Number\"},\n\t\t\t\t{\"values\": [{\"code\": \"negative-infinity\"}], \"name\": \"-  Negative Infinity\"},\n\t\t\t\t{\"values\": [{\"code\": \"positive-infinity\"}], \"name\": \"-  Positive Infinity\"},\n\t\t\t\t{\"values\": [{\"code\": \"not-performed\"}], \"name\": \"Not Performed\"},\n\t\t\t\t{\"values\": [{\"code\": \"not-permitted\"}], \"name\": \"Not Permitted\"}\n\t\t\t]\n\t\t}\n\t]\n},{\n\t\"name\": \"Condition\",\n\t\"version\": \"1.0.0.alpha\",\n\t\"fields\": [\n\t\t{\"name\": \"patient\", \"type\": \"fhirId\", \"field\": \"ptId\", \"exprSuffix\": \"subject.type = 'Patient'\"},\n\t\t{\"name\": \"id\", \"type\": \"fhirId\", \"field\": \"rId\"},\n\t\t{\"name\": \"clinicalStatus\", \"type\": \"coding\", \"field\": \"clinicalStatus\", \"editable\": false,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"active\"}], \"name\": \"Active\"},\n\t\t\t\t{\"values\": [{\"code\": \"recurrence\"}], \"name\": \"- Recurrence\"},\n\t\t\t\t{\"values\": [{\"code\": \"relapse\"}], \"name\": \"- Relapse\"},\n\t\t\t\t{\"values\": [{\"code\": \"inactive\"}], \"name\": \"Inactive\"},\n\t\t\t\t{\"values\": [{\"code\": \"remission\"}], \"name\": \"- Remission\"},\n\t\t\t\t{\"values\": [{\"code\": \"resolved\"}], \"name\": \"- Resolved\"},\n\t\t\t]\n\t\t},\n\t\t{\"name\": \"verificationStatus\", \"type\": \"coding\", \"field\": \"verificationStatus\", \"editable\": false,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"unconfirmed\"}], \"name\": \"Unconfirmed\"},\n\t\t\t\t{\"values\": [{\"code\": \"provisional\"}], \"name\": \"- Provisional\"},\n\t\t\t\t{\"values\": [{\"code\": \"differential\"}], \"name\": \"- Differential\"},\n\t\t\t\t{\"values\": [{\"code\": \"confirmed\"}], \"name\": \"Confirmed\"},\n\t\t\t\t{\"values\": [{\"code\": \"refuted\"}], \"name\": \"Refuted\"},\n\t\t\t\t{\"values\": [{\"code\": \"entered-in-error\"}], \"name\": \"Entered in Error\"},\n\t\t\t]\n\t\t},\n\t\t{\"name\": \"category\", \"type\": \"coding\", \"field\": \"category\", \"editable\": false,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"problem-list-item\"}], \"name\": \"Problem List Item\"},\n\t\t\t\t{\"values\": [{\"code\": \"encounter-diagnosis\"}], \"name\": \"Encounter Diagnosis\"},\n\t\t\t\t{\"values\": [{\"code\": \"health-concern\"}], \"name\": \"Health Concern\"},\n\t\t\t]\n\t\t},\n\t\t{\"name\": \"code\", \"type\": \"coding\", \"field\": \"code\"}\n\t]\n},{\n\t\"name\": \"Demographics\",\n\t\"version\": \"1.0.0.alpha\",\n\t\"fields\": [\n\t\t{\"name\": \"patient\", \"type\": \"fhirId\", \"field\": \"id\"},\n\t\t{\"name\": \"id\", \"type\": \"fhirId\", \"field\": \"rId\"},\n\t\t{\"name\": \"gender\", \"type\": \"coding\", \"field\": \"gender\", \"editable\": false,\n\t\t\t\"options\": [\n\t\t\t\t{\"values\": [{\"code\": \"male\"}], \"name\": \"Male\"},\n\t\t\t\t{\"values\": [{\"code\": \"female\"}], \"name\": \"Female\"},\n\t\t\t\t{\"values\": [{\"code\": \"other\"}], \"name\": \"Other\"},\n\t\t\t\t{\"values\": [{\"code\": \"unknown\"}], \"name\": \"Unknown\"},\n\t\t\t]\n\t\t},\n\t\t{\"name\": \"birthDate\", \"type\": \"instant\", \"field\": \"birthDate\"},\n\t\t{\"name\": \"usCoreRace\", \"type\": \"coding\", \"field\": \"usCoreRace\"},\n\t\t{\"name\": \"usCoreEthnicity\", \"type\": \"coding\", \"field\": \"usCoreEthnicity\"},\n\n\t]\n\n}]","import definitions from \"./definitions.js\";\n\nexport default {\n\t\"nextId\": 7,\n\t\"definitions\": definitions,\n\t\"blocks\": [{\n\t\t\t\"id\": \"root\",\n\t\t\t\"name\": \"All Patients\",\n\t\t\t\"parentId\": null\n\t},{\n\t\t\"name\": \"Demographics\",\n\t\t\"retention\": { \n\t\t\t\"retentionType\": \"all\",\n\t\t\t\"retentionVar\": \"pt\"\n\t\t},\n\t\t\"definition\": definitions[2],\n\t\t\"parentId\": \"root\",\n\t\t\"id\": 0,\n\t\t\"nextRuleId\": 0,\n\t\t\"rules\": []\n\t},{\n\t\t\"name\": \"DM Dx\",\n\t\t\"definition\": definitions[1],\n\t\t\"retention\": {\n\t\t\t\"retentionType\": \"none\",\n\t\t},\n\t\t\"parentId\": 0,\n\t\t\"id\": 1,\n\t\t\"nextRuleId\": 1,\n\t\t\"rules\": [{\n\t\t\t\"id\": 0,\n\t\t\t\"fieldName\": \"code\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"name\": \"SNOMED DM\",\n\t\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\t\"code\": \"105401000119101,106281000119103,10754881000119104,111307005,111552007,123763000,127012008,1481000119100,190330002,190331003,190368000,190372001,190389009,190406000,190407009,190410002,190411003,190412005,199223000,199225007,199226008,199227004,199228009,199229001,199230006,199231005,23045005,237599002,237600004,237601000,237604008,237613005,237618001,237619009,237627000,237651005,24203005,2751001,28032008,31321000119102,313435000,313436004,314771006,314893005,314902007,314903002,314904008,33559001,359642000,368521000119107,408539000,426705001,426875007,427089005,42954008,44054006,445260006,46635009,4783006,51002006,530558861000132104,57886004,59079001,5969009,609561005,609562003,609563008,609564002,609566000,609567009,609568004,609569007,609570008,609571007,609572000,609573005,609574004,609575003,609576002,609577006,609578001,70694009,709147009,710815001,716362006,71791000119104,719216001,720519003,722454003,724136006,73211009,733072002,734022008,75524006,75682002,76751001,81531005,8801005,91352004,9859006\"\n\t\t\t}]\n\t\t}]\n\t},{\n\t\t\"name\": \"Most Recent A1C\",\n\t\t\"retention\": {\n\t\t\t\"retentionType\": \"latest\",\n\t\t\t\"retentionSortField\": \"effectiveDateTimeEnd\",\n\t\t\t\"retentionVar\": \"a1c_2\"\n\t\t},\n\t\t\"definition\": definitions[0],\n\t\t\"parentId\": 1,\n\t\t\"id\": 2,\n\t\t\"nextRuleId\": 2,\n\t\t\"rules\": [{\n\t\t\t\"id\": 0,\n\t\t\t\"fieldName\": \"status\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"Final\",\n\t\t\t\t\"validate\": false\n\t\t\t},{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"Amended\",\n\t\t\t\t\"validate\": false\n\t\t\t},{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"- Corrected\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 1,\n\t\t\t\"fieldName\": \"code\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"system\": \"http://loinc.org\",\n\t\t\t\t\"code\": \"4548-4\"\n\t\t\t}]\n\t\t}]\n\t},{\n\t\t\"name\": \"Most Recent A1C Elevated\",\n\t\t\"retention\": { \"retentionType\": \"none\" },\n\t\t\"definition\": definitions[0],\n\t\t\"parentId\": 2,\n\t\t\"id\": 3,\n\t\t\"nextRuleId\": 2,\n\t\t\"rules\": [{\n\t\t\t\"id\": 0,\n\t\t\t\"fieldName\": \"id\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"target\": \"2.id\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 1,\n\t\t\t\"fieldName\": \"valueQuantity\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"comparator\": \"gte\",\n\t\t\t\t\"compareTo\": \"fixed\",\n\t\t\t\t\"fixedValue\": \"7\",\n\t\t\t\t\"offsetDir\": \"plus\",\n\t\t\t\t\"offsetValue\": 0,\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t}]\n\t},{\n\t\t\"name\": \"Penultimate A1C\",\n\t\t\"retention\": {\n\t\t\t\"retentionType\": \"latest\",\n\t\t\t\"retentionSortField\": \"effectiveDateTimeEnd\",\n\t\t\t\"retentionVar\": \"a1c_1\"\n\t\t},\n\t\t\"definition\": definitions[0],\n\t\t\"parentId\": 3,\n\t\t\"id\": 4,\n\t\t\"nextRuleId\": 4,\n\t\t\"rules\": [{\n\t\t\t\"id\": 0,\n\t\t\t\"fieldName\": \"status\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"Final\",\n\t\t\t\t\"validate\": false\n\t\t\t},{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"Amended\",\n\t\t\t\t\"validate\": false\n\t\t\t},{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"option\": \"- Corrected\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 1,\n\t\t\t\"fieldName\": \"effectiveDateTimeStart\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"comparator\": \"lt\",\n\t\t\t\t\"compareTo\": \"2.effectiveDateTimeStart\",\n\t\t\t\t\"offsetUnit\": \"months\",\n\t\t\t\t\"offsetDir\": \"minus\",\n\t\t\t\t\"offsetValue\": \"1\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 2,\n\t\t\t\"fieldName\": \"effectiveDateTimeStart\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"comparator\": \"gte\",\n\t\t\t\t\"compareTo\": \"0.birthDate\",\n\t\t\t\t\"fixedValue\": \"2020-01-01\",\n\t\t\t\t\"offsetUnit\": \"years\",\n\t\t\t\t\"offsetDir\": \"plus\",\n\t\t\t\t\"offsetValue\": \"18\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 3,\n\t\t\t\"fieldName\": \"code\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"system\": \"http://loinc.org\",\n\t\t\t\t\"code\": \"4548-4\"\n\t\t\t}]\n\t\t}]\n\t},{\n\t\t\"name\": \"Penultimate A1C Elevated\",\n\t\t\"retention\": { \"retentionType\": \"none\" },\n\t\t\"definition\": definitions[0],\n\t\t\"parentId\": 4,\n\t\t\"id\": 5,\n\t\t\"nextRuleId\": 2,\n\t\t\"rules\": [{\n\t\t\t\"id\": 0,\n\t\t\t\"fieldName\": \"id\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\": false,\n\t\t\t\t\"target\": \"4.id\",\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\": 1,\n\t\t\t\"fieldName\": \"valueQuantity\",\n\t\t\t\"edit\": false,\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"comparator\": \"gte\",\n\t\t\t\t\"compareTo\": \"fixed\",\n\t\t\t\t\"fixedValue\": \"7\",\n\t\t\t\t\"offsetDir\": \"plus\",\n\t\t\t\t\"offsetValue\": 0,\n\t\t\t\t\"validate\": false\n\t\t\t}]\n\t\t}]\n\t},{\n\t\t\"name\": \"HTN Dx\",\n\t\t\"retention\": {\"retentionType\": \"none\"},\n\t\t\"definition\": definitions[1],\n\t\t\"parentId\": \"root\",\n\t\t\"id\": 7,\n\t\t\"nextRuleId\": 2,\n\t\t\"exclude\": true,\n\t\t\"rules\":[{\n\t\t\t\"id\":0,\n\t\t\t\"fieldName\":\"clinicalStatus\",\n\t\t\t\"ruleSet\": [{\n\t\t\t\t\"invalid\":false,\n\t\t\t\t\"option\":\"Active\",\n\t\t\t\t\"validate\":false\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\":1,\n\t\t\t\"fieldName\":\"verificationStatus\",\n\t\t\t\"ruleSet\":[{\n\t\t\t\t\"option\":\"Confirmed\"\n\t\t\t}]\n\t\t},{\n\t\t\t\"id\":2,\n\t\t\t\"fieldName\":\"code\",\n\t\t\t\"ruleSet\":[{\n\t\t\t\t\"system\":\"http://snomed.info/sct\",\n\t\t\t\t\"name\":\"SNOMED\",\n\t\t\t\t\"code\":\"10725009, 10964002, 1201005, 123799005, 59621000\"\n\t\t\t},{\n\t\t\t\t\"name\":\"ICD-9\",\n\t\t\t\t\"system\":\"http://hl7.org/fhir/ValueSet/icd-9\",\n\t\t\t\t\"code\":\"401.1, 401.9\"\n\t\t\t}]\t\t\n\t\t}]\n\n\t}]\n}","import { createStoreon } from \"storeon\";\nimport definitions from \"./definitions.js\";\nimport dmExample from \"./dm-example\";\n\nconst defaultState = {\n\t\"nextId\": 1,\n\t\"definitions\": definitions,\n\t\"blocks\": [{\n\t\t\"id\": \"root\",\n\t\t\"name\": \"All Patients\",\n\t\t\"parentId\": null\n\t}]\n}\n\nconst actions = store => {\n\tstore.on(\"@init\", () => {\n\t\treturn /example=true/.test(window.location.search)\n\t\t\t? dmExample\n\t\t\t: defaultState;\n\t});\n\t\n\tstore.on(\"block/upsert\", ({nextId, blocks}, {block, insertAbove}) => {\n\t\tconst result = block.id === undefined ? {\n\t\t\tnextId: nextId+1,\n\t\t\tblocks: blocks.map( b => {\n\t\t\t\treturn b.id === insertAbove\n\t\t\t\t\t? {...b, parentId: nextId+1}\n\t\t\t\t\t: b;\n\t\t\t\t}).concat([{...block, id: nextId+1}])\n\t\t\t} : {\n\t\t\t\tblocks: blocks.map( b => {\n\t\t\t\t\tif (block.id !== b.id) {\n\t\t\t\t\t\treturn b\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn {...b, ...block};\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\tconsole.log(block);\n\t\treturn result;\n\t});\n\n\tstore.on(\"block/delete\", ({blocks}, {id, parentId}) => {\n\t\tconst result =  {\n\t\t\tblocks: blocks\n\t\t\t\t.map( b => b.parentId === id\n\t\t\t\t\t? {...b, parentId}\n\t\t\t\t\t: b\n\t\t\t\t)\t\n\t\t\t\t.filter( b => b.id !== id)\n\t\t}\n\t\treturn result;\n\t});\n\n}\n\nconst store = createStoreon([actions]);\nexport default store;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport {StoreContext} from 'storeon/react'\nimport store from \"./store\";\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <StoreContext.Provider value={store}>\n      <App />\n    </StoreContext.Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}